## 什么是 Modbus 协议？

Modbus 协议是一种通信协议，允许设备通过各种类型的介质进行通信，如串行线和以太网。它是由生产可编程逻辑控制器（PLC）的 Modicon 公司于 1979 年开发的，旨在使这些设备能够相互通信。

Modbus 协议提供了一种消息传递结构，用于以主从通信方式在智能设备之间传递消息。主设备 A 发送的 Modbus 消息会触发从设备 B 的回应。Modbus 协议规定了通信内容、信息的封装方式和消息的发送和接收顺序。

Modbus 协议简单而强大，是工业控制系统的热门选择。作为一个开放标准，任何人都可以自由地使用和修改，这使得它在整个行业中得到了广泛应用。


## Modbus 协议的历史和起源

Modbus 协议是一种通信协议，允许设备通过各种类型的介质进行通信，如串行线和以太网。它是由生产可编程逻辑控制器（PLC）的 Modicon 公司于 1979 年开发的。该协议的初衷是为了与其所生产的可编程逻辑控制器配套使用，而可编程逻辑控制器在制造业中广泛应用于工业机电过程的自动化。

Modbus 组织成立于 2002 年，由一群致力于推广和使用 Modbus 协议的独立用户和供应商组成。该组织的目标是向公众提供有关协议、规范和相关信息的支持。同时，该组织致力于确保 Modbus 协议在工业自动化市场的可用性、持续改进和广泛应用。

自问世以来，Modbus 协议已被广泛应用于各行各业的各类设备中，并由于简单、开放和易实施一直广受欢迎。

## Modbus 协议相关概念

### Modbus 设备/机器

Modbus 设备或机器是使用 Modbus 协议进行通信的真实的物理设备。这些设备的范围广泛，包括从温度传感器到电机控制器的各种设备，并且可以分布在工厂车间或偏远油田等各种地方。

### Modbus 主设备

Modbus 主设备是发起 Modbus 事务的设备。它向 Modbus 从设备发送请求并等待响应。主设备具有与多个从设备通信的能力，并且可以向每个从设备请求不同类型的数据。

### Modbus 从设备

Modbus 从设备是等待 Modbus 主设备请求的设备。一旦收到请求，从设备将处理该请求并将响应发送回主设备。从设备不主动发起通信，它仅响应来自主设备的请求。

### 数据模型和寄存器

Modbus 数据模型基于一系列寄存器，这些寄存器是设备中存储数据的内存位置，它们代表设备内的存储区域。这些寄存器分为两种类型：

- **保持寄存器：**可由 Modbus 主设备进行读取和写入操作。
- **输入寄存器：**仅供主设备进行读取操作。

### 输入类型

在 Modbus 系统中，有两种主要的输入类型：

- **线圈**是 Modbus 协议中的一种数据类型，表示二元状态，如`开/关`或`真/假`。它们可以由 Modbus 主设备进行读写操作。
- **离散输入**类似于线圈，也表示二元状态。然而，与线圈不同的是，离散输入只能被读取，而不能被写入。

### Modbus 消息帧

Modbus 帧是 Modbus 消息的结构。它由起始帧、功能码、数据和结束帧组成。下表显示了 ASCII 协议变体（下文将详细介绍）中帧的结构：

| 开始 | 地址     | 功能     | 数据     | LRC      | 结束  |
| :--- | :------- | :------- | :------- | :------- | :---- |
| :    | 2 个字符 | 2 个字符 | N 个字符 | 2 个字符 | CR LF |

### Modbus 通信模式

Modbus 协议有三种主要通信模式：

- RTU（远程终端单元）
- ASCII（美国信息交换标准码）
- TCP/IP（传输控制协议/互联网协议）

## Modbus 协议的种类

Modbus 协议有多种变体，主要包括：

### Modbus RTU

Modbus RTU 是 Modbus 协议的二进制实现版本。它通常用于串行通信，并以其紧凑的数据表示方式而闻名，这使得它具备高效和快速的特点。

### Modbus ASCII

Modbus ASCII 是 Modbus 协议的 ASCII 实现版本。与 Modbus RTU 相比，它的效率较低，但由于使用人类可读的字符，因此更容易使用和调试。

### Modbus TCP/IP

Modbus TCP/IP 是在 TCP/IP 网络上使用的 Modbus 协议版本。它支持长距离和跨不同网络的通信。

### Modbus UDP

Modbus UDP 是使用 UDP 传输协议的 Modbus 协议版本。它比 Modbus TCP/IP 快，也占用更少的网络资源，但它不太可靠，因为它不能保证数据包能送达或按顺序到达。

### Modbus Plus

Modbus Plus（MB+ 或 Modbus+）是 Modbus 协议的专有变体，由施耐德电气推出。它是一种点对点通信协议，相较于标准 Modbus，Modbus Plus 提供更高的传输速度和更可靠的数据传输保证。

## Modbus 协议的应用

### 工业自动化

Modbus 协议广泛应用于工业自动化领域。在工业环境中，建立一个可靠且高效的通信网络对于维护众多设备和机器之间的良好通信至关重要。Modbus 协议实现了可编程逻辑控制器、传感器和执行器等各种设备之间简单且标准化的通信。它通常用于制造厂、发电厂、炼油厂以及其他工业环境中，用来监控设备和生产过程。

### 车辆系统

Modbus 协议在车辆系统，特别是电动汽车领域也得到了应用。它被用于监测和控制各种参数，如电池管理系统、充电系统和逆变器系统等。Modbus 提供了一种高效且易于实施的协议，能够保障这些系统的稳定运行。

### 物联网通信

随着物联网的兴起，Modbus 协议的重要性日益凸显。Modbus TCP/IP 特别适用于在以太网上实现物联网设备、传感器和控制器之间的通信。它的简单性和广泛支持使其成为物联网通信的常见选择。

### 传感器和执行器通信

Modbus 协议在促进传感器和执行器之间的通信方面起着关键作用。它提供了一种标准接口来传输数据（如传感器的读数或执行器的控制信号）。这使得集中控制系统或可编程逻辑控制器能够协同监控各种设备。Modbus 协议在传感器和执行器通信中的应用非常广泛，涵盖了从工业机械到环境监测系统等各个领域。

## Modbus 协议的局限性

尽管 Modbus 协议具有许多优点，但它也有一些局限性。其中之一是缺乏内置的安全功能。由于该协议是在互联网广泛应用之前开发的，因此没有包含通信安全机制，容易受到网络攻击。

另一个限制是协议的简单性。虽然这使得 Modbus 易于使用和实施，但也意味着它缺乏现代协议中的一些高级功能。

尽管存在这些局限性，由于 Modbus 协议的简单性、稳定性和广泛兼容性，它仍然是许多应用的首选协议。

## 将 Modbus 协议与工业物联网集成：Neuron 和 EMQX

随着[工业物联网](https://www.emqx.com/zh/blog/iiot-explained-examples-technologies-benefits-and-challenges)的发展，Modbus 协议在自动化、控制和数据分析方面与现代物联网设备的集成机会越来越多。通过工业物联网，Modbus 设备能够成为更大互联系统的一部分，通过收集、分析和利用这些设备的数据，来优化操作、提高安全性和降低成本。

[Neuron](https://github.com/emqx/neuron) 是一款开源的边缘工业协议网关，支持多种 Modbus 驱动程序，包括 Modbus TCP、Modbus RTU、Modbus UDP 和 Modbus RTU over TCP。这些驱动程序实现了 Modbus 设备与工业物联网应用之间的无缝集成。通过这些驱动程序，Neuron 能够使用不同的 Modbus 变体与各种工业设备进行通信，从而实现数据采集、控制，并与解决方案的其他组件进行互操作。

以下是对每个 Modbus 驱动程序的说明：

- **Modbus TCP：**Modbus TCP 是一种被广泛使用的通信协议，它允许在 TCP/IP 网络上传输 Modbus 消息。该协议实现了 Modbus 主设备（如 Neuron）与 Modbus 从设备（例如传感器、执行器或其他工业设备）之间的通信。通过 Neuron 的 Modbus TCP 驱动程序，这些设备能够无缝集成并进行通信，从而促进了数据交换和控制操作。
- **Modbus RTU：**Modbus RTU 是一种流行的串行通信协议，用于实现 Modbus 主设备和从设备之间通过串行接口（如 RS-485 或 RS-232）的通信。该协议使用二进制数据表示，并支持半双工通信，数据可以在两个方向上传输，但不能同时进行。Neuron 的 Modbus RTU 驱动程序实现了与使用该串行通信协议的 Modbus 设备的连接，允许在工业环境中进行数据交换和控制操作。
- **Modbus UDP：**Modbus UDP 是 Modbus 协议的另一种变体，使用 UDP 进行通信。UDP 是一种无连接协议，具有低开销和快速传输的特点。Modbus UDP 通常应用于对速度要求较高的场景，如实时控制应用。通过 Neuron 的 Modbus UDP 驱动程序，可以实现与使用 UDP 作为底层传输协议的 Modbus 设备之间的通信。
- **Modbus RTU over TCP：**Modbus RTU over TCP 是一种机制，它允许将 Modbus RTU 帧封装在 TCP/IP 报文中进行通信。这种机制将 Modbus RTU 的简单性和高效性与 TCP/IP 的强大网络功能相结合。通过 Neuron 的 Modbus RTU over TCP 驱动程序，可以与使用 Modbus RTU 协议但通过 TCP/IP 连接到网络的 Modbus 设备进行通信。

[EMQX](https://www.emqx.com/zh/products/emqx) 是业界领先的高性能 [MQTT Broker](https://www.emqx.com/zh/mqtt/public-mqtt5-broker)，为工业物联网通信提供快速可靠的消息传递服务。结合支持多种工业协议的开源边缘网关 Neuron 实现与 OT 设备的灵活连接和安全数据交换，两者构成了支持工业物联网基础设施建设的强大组合。通过它们的协同作用，确保了工业物联网环境中的无缝集成和稳定的数据通信，同时还实现了先进的分析和控制能力，为工业物联网应用提供了强大的支持。

了解更多关于 EMQX 和 Neuron 在 Modbus 环境中的应用，请阅读：[工业物联网数据桥接教程：Modbus 桥接到 MQTT](https://www.emqx.com/zh/blog/bridging-modbus-data-to-mqtt-for-iiot)。



<section class="promotion">
    <div>
        免费试用 Neuron
    </div>
    <a href="https://www.emqx.com/zh/try?product=neuron" class="button is-gradient px-5">开始试用 →</a>
</section>
