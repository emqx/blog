## 背景

在全球掀起的新一轮工业转型浪潮中，智能制造面临巨大发展机遇。未来智能制造业生产方式将朝着智能化方向提升，个性化定制、网络化协同、智能化生产、服务化延伸成为引领制造业高端化的重要模式，个性化、定制化的用户需求将促使企业向生产柔性化发展。

与流程制造业相比，智能制造生产环节更加分散，生产设备更加多样，工序繁杂。生产柔性化的发展趋势则给企业的生产质量管理带来了更大的挑战。提升产品质量水平是企业市场竞争中最有力的武器，是企业发展的重要战略手段。

产品质量溯源作为重要的制造过程质量管理手段，很大程度上影响着产品在制造过程中的质量水平。产品质量溯源通过追踪整个制造过程数据，并分析找到影响产品质量水平的原因，为企业制造过程的改进提供依据，从「人机料法环」各个维度全面提升工厂质量管控能力。

## 产品质量溯源现状分析

### 数据分散，整合成本高

在智能制造生产过程中，涉及到现场多工序、多产线生产设备的多源异构协议数据采集，生产经营相关业务数据和产品设计工艺数据，以及 MES、WMS、ERP 等工厂管理系统的对接。数据的全面感知和采集，是进行产品质量溯源的必要条件。

### 缺乏数据过滤能力

在现场设备侧，缺乏数据分析过滤能力，导致冗余数据、无效数据在存储端大量堆积，造成数据存储压力，质量溯源分析耗时耗力。

### 数据查询分析能力弱

传统方式下，MES 系统将生产数据通过关系型数据库采集存储，进行产品质量追溯。随着智能制造发展趋势，生产数据高频采集，数据规模倍增，采用传统方式无论在查询效率还是数据分析能力方面，都无法满足产品质量溯源的性能要求。

### 实时智能分析告警能力弱

在生产过程中，没有充分利用机理模型、AI 算法模型对生产数据进行实时分析，无法及时发现生产数据异常并推送告警信息，影响产品质量及合格率的提升。

## EMQ 产品质量溯源解决方案

EMQ 产品质量溯源解决方案，通过云原生技术以及云边协同架构，实现对海量设备数据的连接、移动、处理、存储与分析。方案主要包括以下软件：

| **组件**       | **名称**                                                     |
| -------------- | ------------------------------------------------------------ |
| 边缘数采软件   | [Neuron - 工业协议网关软件](https://www.emqx.com/zh/products/neuron) |
| 边缘 Broker    | [NanoMQ - 超轻量级边缘 MQTT 消息服务器](https://nanomq.io/zh) |
| 边缘计算软件   | [eKuiper - 超轻量物联网边缘数据流式分析引擎](https://ekuiper.org/zh) |
| 物联网接入平台 | [EMQX BC - 云原生分布式物联网接入平台](https://www.emqx.com/zh/products/emqx) |

### 多维度数据高效采集

利用 Neuron 将工厂内 PLC、非标自动化设备、SCADA 以及各类仪器仪表通过现场总线方式进行实时数据采集。Neuron 支持 [Modbus](https://www.emqx.com/zh/blog/modbus-protocol-the-grandfather-of-iot-communication)、OPCUA、 Siemens S7 等 80+ 现场总线协议采集，最高采集频率可到100ms，还支持通过 MQTT 和 Restful API 等方式实现对工厂设备的反向控制功能。

数据流式分析引擎 eKuiper 可以对各类应用 API 接口进行数据拉取，通过配置界面设置接口地址、数据拉取频率，并可将拉取数据的格式再定义，并实时推送到 EMQX BC 中，实现工厂 MES、视频监控等各类系统的数据汇聚。此外，eKuiper 还支持定期查询数据库以获取批量工厂数据。

通过 Neuron+eKuiper 对多维度数据的高效采集，可以将工厂内机器设备的实时数据、生产经营相关业务数据、产品设计工艺数据以及工厂各类生产管理软件中数据进行统一汇聚，为产品质量溯源提供了完备的数据支撑。

### 边缘分析

eKuiper 除了上述提到的数据拉取功能外，还可以在边缘端对数据进行实时计算分析、过滤清洗、智能告警等。eKuiper 提供了灵活的 SQL 语法以及数据模板功能，可以实现：

1. 对智慧工厂多厂家设备、多维度数据源的数据格式标准规范化；
2. 实时测点高阶分析能力，除了对实时数据进行简单的数据函数计算和阈值判断外，还支持自定义函数和 AI 算法模型集成，可以将 Python、C/C++、Matlab 算法集成进行边缘实时推理，帮助实时发现设备异常及产品缺陷；
3. 通过 eKuiper 的时间窗口函数可以对高频采集的冗余数据进行过滤清洗。eKuiper 多流计算功能可以对工序中的关键信息数据进行抓取，处理后再发送到 EMQX BC，大大降低了后端存储压力并提高了产品质量溯源的效率。

以某半导体生产工厂为例，通过 eKuiper 的多流计算功能，可以将多个工艺流程的数据进行跨工艺的数据对齐，在边缘端对数据进行整合；在上下料单工艺段中，产品通过传送带传送并通过多个传感器对产品状态信息进行采集，eKuiper 可拉取 MES 系统中的配方数据，根据传送带的动态运行速度以及布尔信号状态，进行无效数据过滤及复杂数据补齐功能。

![智慧工厂](https://assets.emqx.com/images/c05520987cacfc441ccc14a029db973a.png)

### 实时存储、高效查询

云原生分布式物联网接入平台 EMQX BC 内置规则引擎功能，将工厂内各类汇集而来的数据，实时推送到  InfluxDB、TimescaleDB、TDengine、MySQL、PostgreSQL 等各类时序数据库和关系型数据库中。EMQX BC 支持每秒 10万+TPS 的数据库数据写入性能，可进行每秒千万级数据测点的实时入库。EMQX BC 将多端 Neuron、eKuiper 采集分析的数据进行统一汇聚，数据推送到数据库及大数据系统逆行持久化存储，为产品质量溯源构建了健壮的底层数据架构。

同时，EMQX BC 支持可弹性扩展的集群模式，随着业务增长可以不停机拓展集群规模。单个集群可以处理百万 TPS 的消息并发，在工厂产线持续扩充以及业务场景对数据采集频率不断加快的情况下，具备良好可扩展性和稳定性的数据架构层也能从容应对。

![EMQX Dashboard](https://assets.emqx.com/images/de156187e55f7fea6e2ca281cef99403.png)

### 云边协同统一管理

多维度数据采集以及边缘分析会使用非常多的边缘软件，EMQX BC 云边协同控制台将 Neuron、eKuiper 等众多边缘软件进行远程统一管理，可以监控边缘软件状态、收集边缘软件日志、实时推送告警信息、保证边缘软件的高可用性以及一键实现边缘软件的版本升级管理，大大提高了整体系统的可维护性及易用性，显著降低运维成本。

![云边协同统一管理](https://assets.emqx.com/images/47f421f0af0411ba4b8aa5c1e4b4513b.png)

## 结语

针对智慧工厂所面临的质量溯源需求，EMQ 基于云原生和云边协同的产品质量溯源解决方案，在现场设备端可实现数据的实时采集分析和异常报警，在云端实现工厂海量数据的统一接入存储，打破信息孤岛，充分发掘数据价值，助力工厂实现数字化、实时化及智能化转型。



<section class="promotion">
    <div>
        联系 EMQ 工业领域解决方案专家
    </div>
    <a href="https://www.emqx.com/zh/contact?product=solutions" class="button is-gradient px-5">联系我们 →</a>
</section>
