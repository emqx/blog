随着国家推进工业 4.0 与智能制造，工业互联数据平台作为连接物理世界与数字世界的桥梁，发挥着至关重要的作用。通过工业互联数据平台，工业企业能够实现设备数据的实时采集、监控与分析，从而优化生产流程、提高生产效率、降低运营成本。

**本文介绍如何基于社区中的开源和商业化软件，构建一个功能全面的工业互联数据平台，集工业数据采集、汇聚、清洗、存储分析以及可视化展示等能力于一体。**基于这一方案，读者可以根据自身的业务需求灵活调整设计，进而搭建出符合实际业务场景的工业互联数据平台，推动工业企业智能化转型。

## 工业互联网面临的挑战

据中国工业和信息化部信息中心最新的[《工业互联网体系架构（版本2.0）》](https://www.miit.gov.cn/ztzl/rdzt/gyhlw/jyjl/art/2020/art_e8333f59a1af4c0590247987108d318c.html)所述，工业互联网架构下的边缘层主要提供海量工业数据接入、转换、数据预处理和边缘分析应用等功能。具体来说，边缘层主要实现以下三种功能：

1. 工业数据接入：涵盖机器人、机床、高炉等工业设备的数据接入能力，以及 ERP、MES、WMS 等信息系统的数据接入能力，实现对各类工业数据的大范围、深层次采集和连接。
2. 协议解析与数据预处理：将采集连接的各类多源异构数据进行格式统一和语义解析，然后经过数据剔除、压缩、缓存等操作后传输至云端。
3. 边缘分析应用：重点针对高实时应用场景，在边缘侧开展实时分析与反馈控制，并提供边缘应用开发所需的资源调度、运行维护、开发调试等各类功能。

然而，在工业领域，多种协议并存，如何将异构设备连接并将数据汇聚，以实现后续的边缘或云端计算，是行业共同面对的挑战。目前，针对这一挑战，行业内通用的解决方案主要有两种：

1. 在边缘端，传统方式采用直接连接和控制设备的程序。这种方式主要适用于特定设备或型号，因此定制程度较高。然而，其可移植性、可重用性、可扩展性和灵活性均存在不足，难以与当前的大数据和AI后台对接，也无法对数据进行深入分析以产生更多价值。
2. 将云端架构的软件部署到边缘端。 云端由 IT 产业主导，信息化程度非常高。但基于成本考虑，边缘端的硬件设备一般计算能力有限，因此直接将云端架构的软件迁移到边缘设备并不可行。为了在边缘端实现上述功能，软件必须经过优化以适应其实际运行环境。

为了融合在边缘 OT和 IT 端的不同需求， EMQ 正式推出了[**工业互联数据平台 EMQX ECP**](https://www.emqx.cn/products/emqx-ecp)。该平台旨在帮助领域内相关企业应对工业互联网边缘端所面临的挑战，满足工业场景大规模数据采集、处理、存储和分析的需求。ECP 提供边缘服务 NeuronEX 的快速部署、远程操作和集中管理等功能，促进工业领域数据的互联互通，实现数据驱动的生产和运营。下文将分别对 NeuronEX 和 ECP 进行介绍，讲解 EMQ 是如何通过这两款软件解决上述问题的。

## 解决方案

### 边缘端：轻量级工业边缘网关软件 NeuronEX

[NeuronEX](https://www.emqx.com/en/products/neuronex) 是一款工业边缘网关软件。它提供设备数据采集和边缘智能分析服务，主要部署于工业现场。NeuronEX 实现了工业设备通信、工业总线协议采集、工业系统数据集成、边端数据过滤分析以及 AI 算法集成等功能，并与工业互联数据平台实现了对接集成。这些功能为工业场景提供了低延迟的数据接入管理及智能分析服务，帮助用户快速洞察业务趋势，从而提升运营效率和可持续性。

![轻量级工业边缘网关软件 NeuronEX](https://assets.emqx.com/images/744ef5afac9d9cc1f3629284e7a53d37.png)

如上图所示，NeuronEX 主要分为数据采集接入、数据处理分析、数据转发存储以及系统管理等模块。

#### 产品优势

- 丰富的协议接入

  凭借多样的协议插件，NeuronEX 能满足在各种工业场景下对 PLC、CNC、机器人、SCADA 以及智能仪表等设备数据的实时采集与统一接入的需求。内置了包括 [Modbus](https://www.emqx.com/zh/blog/modbus-protocol-the-grandfather-of-iot-communication)、OPC UA、Ethernet/IP、IEC104、BACnet、Siemens、Mitsubishi 等在内的多种插件模块，这些插件模块在楼宇自动化、数控机床、机器人技术、电力系统和各种 PLC 通信中都有着广泛的应用。

- 低延迟数据处理

  专为工业现场设计的低延迟数据接入和处理能力，确保数据在多系统间的快速传递，实现实时监控和决策。

- 轻量及灵活部署
  NeuronEX 具有轻量化、低内存占用等特性，支持多种 CPU 架构部署，并且支持 Docker、Kubernetes 容器化部署。

- 完整的数据分析能力

  内置数据抽取、转换、过滤、排序、分组、聚合、连接等功能，更有 160+ 各类函数，覆盖数学运算、字符串处理、聚合运算和哈希运算等，通过强大的流式计算分析能力，实现数据的过滤清洗、标准化处理、分析监测及实时报警等功能。

- AI/ML 分析
  支持用户自定义函数扩展和 AI 算法集成，为用户提供智能数据分析的能力，助力工业智能化升级。

- 平台集成

  通过 [MQTT](https://www.emqx.com/zh/blog/the-easiest-guide-to-getting-started-with-mqtt)、SparkplugB、HTTP 等多种对接方式，轻松将数据集成到本地数据中心、工业互联数据平台或云服务中，实现数据的无缝连接和高效管理。

**支持的软硬件环境**

- 树莓派、网关、工控机
- x86 & ARM - 64 位和 32 位
- 物理机，常见 Linux 系统的支持
- 容器化部署，Docker & K8s 等支持

### 平台端：工业互联数据平台 EMQX ECP

EMQX ECP 一款面向工业 4.0 的工业互联数据平台，旨在满足工业场景大规模数据采集、处理和存储分析的需求。通过提供边缘服务的快速部署、远程操作及集中管理等功能，ECP 有力地促进了工业领域数据的互联互通。以数据 + AI 驱动生产监测、控制和决策过程，实现智能化生产，提高生产效率、质量和可持续性，最终实现数据驱动的生产和运营。

![工业互联数据平台 EMQX ECP](https://assets.emqx.com/images/6c30b97a507bdb8bd344d0f798cbe46f.png)

#### 产品优势

- **软件定义制造**
  将物联网、大数据、和人工智能等数字技术整合到生产制造过程中，以数据为核心进行生产监控和决策优化，推动智能化生产，提高效率、质量和可持续性。
- **消除数据孤岛**
  将工厂海量数据统一接入，利用[统一命名空间架构（UNS）](https://www.emqx.com/zh/blog/unified-namespace-next-generation-data-fabric-for-iiot)实现系统的互操作性，连接从边缘到云的 OT 和 IT 系统，打破数据孤岛。
- **工业人工智能**
  将制造数据实时发送到云端进行 AI/ML 训练，随后将训练后的 ML 模型下发到工厂车间执行，实现生产计划优化、质量控制以及预测性维护。
- **实时分析**
  支持实时流式数据处理和转发，可在边缘执行原始数据预处理、过滤和分析。有助于减少延迟、节省带宽，并减轻云平台的计算负担。
- **云边协同**
  与云平台无缝集成，提供边缘软件的全生命周期管理，统一远程配置及管理。实时远程监控，及时发现运行异常，确保系统稳定可靠。
- **无缝集成**
  可与现场的硬件、网络等基础设施适配和集成。无论是服务器、工控机还是网关硬件，还是各类网络环境，都能顺利部署和使用，不受硬件厂商的限制。

#### 产品功能

- **边缘服务管理**
  1. 提供全托管和纳管两种边缘服务管理方式。全托管支持 Docker/K8s 部署；托管服务可以在平台上批量进行部署、升级、启停、重启操作。
  2. 统一的边缘服务访问入口，无需二次鉴权，也无需记住每一个边缘服务的访问地址、用户名和密码。可以在平台端直接访问到部署在边缘侧的 NeuronEX 的 Dashboard 。
  3. 统一的边缘服务配置导入和导出功能，支持数采配置、数据处理规则等对象管理。AI 算法插件也可以在平台端进行统一管理，按需分发。未来，我们还计划支持 NeuronEX 的全局配置备份导入、导出等功能。
  4. 统一的动态点位分配管理机制，可以按需给每个 NeuronEX 分配不同的点位配额，并随时进行修改。
- **数据接入平台管理**
  1. EMQX 集群管理，支持纳管和托管两种方式，可以通过 ECP 平台直接访问 EMQX Dashboard，免二次鉴权。
  2. EMQX 集群基于 K8s 的自动部署，支持部署、升级、启停、重启操作、横向扩容以及纵向扩容。
  3. EMQX 集群版本统一管理。
- **统一运维服务**
  1. 统一的指标收集，监控信息展示
  2. 健康监测及异常告警
  3. 告警管理、告警规则配置
  4. 告警推送功能，可分组配置告警推送范围和告警推送对象
  5. 统一的日志服务，包含 ECP、 EMQX 以及 NeuronEX 的日志
- **企业级服务**
  1. 操作审计
  2. 租户隔离
  3. 基于项目和用户的管理、RBAC 的权限管理
  4. 业务分组
  5. 统一认证，可接入已有的 SAML 认证服务

### 云边互通：快速部署 EMQX ECP & NeuronEX

为了使试用更加简单，本文利用 Docker 和 Docker compose 技术进行快速部署，请在 Linux 机器上尝试以下的内容，Mac 与 Windows 的 docker bridge network 有一些缺陷，可能无法实现 Demo。

- **ECP 部署**

  1. 下载最新的 ECP Docker compose [安装包](https://www.emqx.com/zh/downloads-and-install/emqx-ecp)，然后解压

     ```shell
     $ tar -xzvf emqx-ecp-docker-compose-installer-2.1.1.tar.gz && cd docker-compose
     ```

  1. 依赖检查

     ```shell
     $ ./emqx_ecp_ctl precheck
     ```

  1. 配置环境

     ```shell
     $ ./emqx_ecp_ctl configure
     ```

  1. 启动服务

     ```shell
     $ ./emqx_ecp_ctl start
     ```

  1. 检查服务状态

     ```shell
     $ ./emqx_ecp_ctl status
     ```

  1. 创建超级管理员

     ```shell
     $ ./emqx_ecp_ctl create-user
     Please input username:          # 请设置您的用户名，需要为email格式
     Please input password:          # 请设置您的账户密码
     Please input password again:    # 请重复您的账户密码
     Please input your name:         # 请为您的账户设置一个显示名称，比如 ECPAdmin
     ```

  1. 登陆 ECP。ECP 的默认访问地址为 `http://{您的机器IP}:8082`。

- **NeuronEX 部署**

  NeuronEX 支持的[部署方式](https://docs.emqx.com/zh/neuronex/latest/installation/introduction.html)有 `rpm/deb/tar.gz/Docker` ，本文以 Docker 安装方式为例。

  ```shell
  $ docker run -d --name neuronex -p 8085:8085 --log-opt max-size=100m emqx/neuronex:latest
  ```

- **ECP 纳管 NeuronEX**

  在 ECP 上，按照[文档](https://docs.emqx.com/zh/emqx-ecp/latest/edge_service/batch_import.html#添加一个现有服务)指引，添加一个现有的边缘服务，即可将之前部署的 NeuronEX 纳管到 ECP 中。为边缘服务命名时，建议根据其实际用途选择一个有描述性的名称。在填写地址时，请确保根据实际情况输入部署 NeuronEX 服务的节点的 IP 地址和端口号，例如：127.0.0.1:8085。

  纳管成功后，您几乎可以在 ECP 上配置和修改 NeuronEX 的所有业务功能。此外，ECP 也可对 NeuronEX 进行状态监控和异常告警等增强功能。 同时，结合ECP 对 EMQX 的管理能力，您可以进一歩扩展工业互联网云边一体化的应用体验。

### 总结

基于本文所描述的方案搭建的工业互联数据基础能力平台，使用户能够实现高效、低成本的工业互联网设备连接、数据采集和分析。无论是采用轻量级的纯边缘方案，还是部署在复杂环境中的云边一体协同方案，均可以通过本文的方案得以顺利实施。



<section class="promotion">
    <div>
        咨询 EMQ 技术专家
    </div>
    <a href="https://www.emqx.com/zh/contact?product=solutions" class="button is-gradient px-5">联系我们 →</a>
</section>
