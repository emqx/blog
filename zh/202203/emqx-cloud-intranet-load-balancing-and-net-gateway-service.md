为了满足用户在物联网平台架构搭建上的个性化需求，本月初，[EMQX Cloud 专业版推出了两项重要的增值服务：内网负载均衡服务以及 NAT 网关服务。](https://www.emqx.com/zh/blog/emqx-cloud-launched-value-added-services)

作为一款全托管、云原生的 MQTT 消息服务，[EMQX Cloud](https://www.emqx.com/zh/cloud) 旨在通过标准易用的 SaaS 模式，为用户减轻物联网基础设施的搭建成本和运维负担。全新上线的增值服务模块更是为用户根据自身需求灵活开展业务提供了充分的选择空间，更加有效地控制成本。

那么，**这两个增值服务分别更适用于哪些用户呢？**

## EMQX Cloud 专业版：中大规模物联网业务首选

首先需要了解的是这两项增值服务均基于 EMQX Cloud 专业版提供。

专业版是 [EMQX 物联网消息中间件](https://www.emqx.com/zh/products/emqx)在公有云上提供的高可用专有集群服务，主要面向具有以下特征的企业关键业务或者中大规模接入量的物联网平台：

- 设备接入量较大
- 设备或者客户端与平台应用之间数据吞吐量较高
- 对数据接入与存储有较高的可靠性要求

EMQX Cloud 专业版提供了**用户独享的高可用 EMQX 集群**，以及基于 EMQX 内置规则引擎的高可靠高吞吐的北向（从设备发送到应用）数据桥接与数据持久化功能。同时还提供了 VPC 对等连接能力，可以将 EMQX Cloud 服务与客户业务应用服务部署在同一个公有云机房中，并打通两者的内网连接，通过内网访问方式实现海量数据的可靠存储以及对接高吞吐消息队列，帮助业务应用层实现**数据接入与数据消费解耦**。

专业版方案既可以保证数据传输的稳定性，又节约了从 EMQX 到用户 VPC 之间的公网带宽费用。

![EMQX Cloud 专业版](https://assets.emqx.com/images/0c78b96416e35af3e69caa3a038b9d52.png)

## 稳定高效传输同时节省公网流量

## 选内网负载均衡

标准 EMQX Cloud 专业版提供了统一的基于规则引擎的北向数据接入方案。在架构相对复杂的物联网平台设计中，很多业务应用层也需要直接通过 [MQTT](https://www.emqx.com/zh/mqtt) 订阅方式消费 EMQX 中的数据。

一方面，实时数据可以通过直接订阅方式快速推送到业务应用服务中，时延低、中间环节少。对于数据吞吐量不大而对时延要求较高的业务，如设备告警等场景，选择直接订阅方式来实现数据消费是比较常见的。

另一方面，很多用户也会采用 EMQX 提供的共享订阅方式来订阅消费数据（详情请参考：[共享订阅](https://docs.emqx.com/zh/cloud/latest/connect_to_deployments/shared_subscription.html) ）

在以上情况中，使用标准 EMQX Cloud 专业版服务只能通过访问 EMQX 集群公网地址的方式进行直接订阅消费，不仅需要消耗外网流量，在网络链路可靠性与传输速率上，相对直接内网连接都会有所衰减。

内网负载均衡服务即可解决这个问题。它是一种通过内网连接方式对流量进行按需分发的服务，因此在开通此服务前需要配置与应用服务的 VPC 对等连接。

![EMQX Cloud 内网负载均衡器](https://assets.emqx.com/images/311175948d8980d3b0201a4f4b9988e0.png)

根据上图我们可以发现，在开通了内网负载均衡服务后，业务应用系统可以通过指向绑定在某个 EMQX Cloud 实例中的内网负载均衡地址来进行基于内网的消息订阅。不仅满足了数据传输的可靠性，也节省了公网带宽。

因此，如果您有以下需求，开通内网负载均衡服务是一个非常合适的选择：

- 业务应用需要通过直接订阅 [MQTT 主题](https://www.emqx.com/zh/blog/advanced-features-of-mqtt-topics)方式（包括使用共享订阅方式）消费数据；
- 通过直接订阅方式消费数据吞吐量比较大，公网带宽流量消耗比较快；
- 对直接订阅方式的数据传输速率与稳定性有较高要求；

## 跨机房跨云访问公网或其他外部服务

## 选 NAT 网关

在使用 EMQX 作为 MQTT 消息中间件的应用场景中，除了客户端主动连接 EMQX 来发布订阅数据外，EMQX 也可以主动访问外部资源的方式实现数据推送，比如：

- 通过 EMQX 规则引擎中提供的 Webhook 方式调用外部系统接口地址来推送数据；
- 在 EMQX 规则引擎数据源中配置数据库或消息队列的访问地址，使用规则引擎向相关数据源推送数据；

这两种场景也是 EMQX 对接业务应用层的主要消息推送方式。一般情况下，在使用标准的 EMQX Cloud 专业版服务时，更多的是通过 VPC 对等连接走内网方式访问业务应用层的接口与存储服务。

随着分布式架构以及跨地域、跨云厂商的架构逐渐增多，仅仅通过 VPC 对等连接方式对接业务应用与数据存储服务已经不能完全满足用户的需要，这就**需要 EMQX Cloud 提供直接访问外网地址能力来实现跨公网业务应用对接**。NAT 网关服务也就应运而生。

![EMQX Cloud NET 网关](https://assets.emqx.com/images/f08e9eb173a12978936acf07912cb30f.png)

NAT 网关服务提供了网络地址转换服务，为 EMQX Cloud 专业版部署提供访问公网资源的能力。在架构上为专业版用户提供了主动访问公网服务的数据通道，使用户可以更加灵活地构建平台架构。

总的来说，NAT 网关服务更适合有以下需求的用户开通：

- 需要在专业版中通过 Webhook 方式访问公网服务地址来推送数据
- 需要访问提供公网地址的数据库服务或者消息队列服务；
- 需要跨机房或跨云厂商访问外部服务；

> 需要注意的是，使用 NAT 网关访问外部服务时将会消耗公网带宽与公网流量，在数据吞吐量比较大或者数据可靠性要求较高的场景中建议尽量走内网方式对接业务应用与服务。

## 写在最后

本文从架构设计、应用场景等方面为用户分析了两项增值服务最适合的使用场景，希望可以帮助物联网架构师合理选择更加安全可靠且高性价比的解决方案提供参考。两项增值服务 **14 天免费试用**活动均在进行中，欢迎访问[https://www.emqx.com/zh/cloud](https://www.emqx.com/zh/cloud)并申请试用。

未来 EMQX Cloud 将结合用户需求上线更多增值服务模块，敬请关注。


<section class="promotion">
    <div>
        免费试用 EMQX Cloud
        <div class="is-size-14 is-text-normal has-text-weight-normal">无须绑定信用卡</div>
    </div>
    <a href="https://www.emqx.com/zh/signup?continue=https://cloud.emqx.com/console/deployments/0?oper=new" class="button is-gradient px-5">开始试用 →</a >
</section>
