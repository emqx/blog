「xxx 到账 xx 元」，在我们的日常线下消费场景中，经常可以听到商家类似这样的收款语音播报。在这背后，其实是收钱音箱为代表的众多支付收款设备所连接的 **金融支付物联网**。

## 快速发展的聚合支付

聚合支付在 2014 年伴随扫码支付而产生，收单商户可以通过智能POS、智能扫码设备、智能收款音箱等多种收付款设备，打通支付宝、微信支付、云闪付、花呗、信用卡等支付通道，通过接口对接和结算技术服务实现二维码收付款。

随着 2016 年费率改革实施后商户手续费下降导致收单机构利润直线下滑，以及收单业务为银行带来的交易量增长和存款、结算、信贷等业务发展的数据支持，聚合支付很快吸引了收单外包机构、第三方收单机构及银行纷纷入局，逐渐成收单支付领域的主流方式。

而聚合支付的实现必然要面对众多支付终端与移动支付设备接入、海量信息通讯、弱网低时延、加密传输等需求。经过与金融支付行业众多企业客户的长期合作与实践， **EMQ 逐渐形成的完善成熟的[金融支付行业解决方案](https://www.emqx.cn/solutions/finance_pay)，完美满足了包括聚合支付在内的各个金融场景的物联网业务需求**。

## 金融支付场景中的 MQTT

在金融行业中，数字支付既是必然趋势，也是众多银行、IT 服务商以及大型商户所面临的挑战。以目前物联网设备的接入数量与未来的发展速度，如何解决数十万、百万乃至上千万的接入量级是电子交易业务相关供应商应该规划思考的问题。因此，电子交易业务迫切需要一个海量、实时、高可用、安全的信息交互系统。

物联网 [MQTT 协议](https://www.emqx.cn/mqtt)具备轻量、低带宽、低能耗、异步等特性，更加适用于资源受限、网络环境复杂、低功耗的环境要求。其发布订阅模式将发布者与订阅者解耦，使得订阅者与发布者不需要建立直接连接，同时可以提供心跳机制、[遗嘱消息](https://www.emqx.cn/blog/use-of-mqtt-will-message)、[QoS 消息控制质量](https://www.emqx.cn/blog/introduction-to-mqtt-qos)、离线消息、主题和安全管理等，专为物联网而生并发展成为物联网行业事实标准，是构建智慧金融物联设备接入的最佳选择。

在 [MQTT 中间件](https://www.emqx.cn/products/broker)领域，[EMQ X](https://www.emqx.cn/products/broker) 所具有的高性能、高可用卓越稳定性、良好扩展性以及丰富功能使其在方案构建中优势明显。

EMQ X 采用高并发、高稳定、分布式集群开发语言 Erlang/OTP，EMQ X 企业级消息中间件可以支持集群部署与快速扩展，在相同的硬件设施条件下，可提供同行业竞品的数倍级能力。

截至目前，EMQ X 在 7*24h 不间断服务下，已为企业级用户提供超过5年稳定的运行与服务，在 SLA 高达99.99%以上的要求下，EMQ X 依旧稳健。

作为核心数据接入侧，EMQ X 拥有强大的规则引擎功能，可以实现数据分流过滤、数据持久化、数据桥接、编解码、业务应用集成等，在数据层通道即实现数据的处理与过滤，数据路由、控制、监控层的分离，使得 EMQ X 在路由通道中聚焦，保证消息高效处理的同时，实现准确的控制与监控信息展示。

EMQ X 南向支持 MQTT、LwM2M、CoAP 等物联网协议以及私有 TCP/UCP 协议的接入，并提供 TLS/DTLS 以及访问控制认证能力，为数据的安全保驾护航，北向提供标准的 RESTful API 用于管理监控以及 Kafka 消息下发通道，方便第三方快速集成应用。

EMQ X 在公有云、私有云、混合云、物理机以及容器化多种部署化方式和成熟的产品形态，可以一站式解决金融业态中亟需解决的问题。

## EMQ 金融支付行业解决方案

在众多商业客户应用实例中，EMQ X 整合各构架共通点，以多集群为典型部署方式形成了以下方案。

![EMQ 金融支付行业解决方案架构图](https://static.emqx.net/images/6247b73f00f0e680547ae7f18ee1433f.png)

​     

其从接入、数据服务与应用层分别介绍如下：

### 接入侧

多数以 MQTT over TLS 通讯协议接入，其他物联网协议通过协议转换网关和 EMQ X 通讯，这样，扫码以及收款音箱可以安全接入到 EMQ X Enterprise，保证播设备可以接收到所需显示与播报的数据。

### 数据服务侧

EMQ X Enterprise 前端部署 LB 做负载均衡并终结 TLS 连接，后端部署数据库可实现数据持久化服务和存放离线消息。同时，Authentication 和 ACL 数据也可使用数据库存储，提供设备接入安全和应用层访问控制安全。EMQ X 可将数据高性能桥接至 Kafka，供其他后台业务使用，因此，在应用服务侧可通过部署 Kafka 数据流服务，实现业务系统的消费。当收付款码行为发生时，EMQ X 将需要处理的业务数据带到后端系统进行处理，并在毫秒级内返回处理结果，由收付款设备屏幕显示或者音响播报。另外，EMQ X 支持解析 JSON Payload字节，并能以消息内容和消息事件触发规则引擎，为智能的更多应用开发对接提供便捷。

### 应用侧

EMQ X Enterprise 提供了丰富的 API 接口，也支持 Python/Java 多语言钩子函数开发，可以以少量开发投入支持不断加入的业务服务，满足业务增长需求。

## 聚合支付大势下金融物联网的挑战与机遇

聚合支付场景下，从 POS 机到收款音箱等，各类支付物联设备均需要稳定可靠的数据接入，从而通过良好的用户体验获取更多的终端用户。以收钱音箱语音播报为例，在收付款高峰期获得秒级客户与到账反馈，收款记录可以在后台可视化管理，有效防止漏单偷单，是众多终端商家用户选择使用收钱音箱的原因。而要想保障用户体验，需要设备信号抗干扰能力强，实现快速稳定的播报。这无疑对其背后的物联网支撑平台提出了更高的要求。

在现有金融行业客户的服务案例基础上总结经验，EMQ 将不断完善金融与支付行业解决方案，使领域内更多企业从容应对金融支付数字化、信息化挑战，把握万物互联时代下的新机遇。
