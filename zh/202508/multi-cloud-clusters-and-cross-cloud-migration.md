想象一下，仅仅因为一次云服务的中断就让业务停摆，造成数百万美元的收入损失。2025 年 6 月，Google Cloud Platform（GCP）的全球性中断让无数企业陷入服务瘫痪，充分暴露了单一云架构的脆弱性。

正因如此，多云战略成为企业的新选择：通过将工作负载分布在阿里云、华为云和腾讯云等不同云平台之间，企业不仅能规避供应商锁定，还能优化成本效率并消除单点故障。然而，多云部署也面临着管理复杂性和数据可移植性等挑战。

Cluster Linking「集群连接」作为 EMQX 平台的核心功能，提供了跨云集群的无缝连接方案，为物联网基础设施赋予灵活性、可扩展性和高可用性，助您真正实现多云架构的价值。

## 集群连接对于多云部署至关重要

集群连接解决了跨不同云环境的分布式系统固有的挑战，将独立的集群转变为具有凝聚力和弹性的消息传递平台。

- **构建统一、高可用的平台：**

  通过集群连接功能，将部署在不同云平台和区域的 EMQX 集群连接起来，创建了一个所有集群都能充当统一 MQTT 消息平台的系统，无需考虑集群的云供应商。无论客户连接到哪个集群，都能与连接到其他集群的设备进行无缝通信，同时**显著增强高可用性和灾难恢复能力**。如果一个云平台或区域发生故障，另一个云中相互连接的集群可以无缝接管，确保业务连续性和服务零中断。

- **实现无缝跨云通信和路由：**

  由于不同云平台之间的网络隔离，传统的 MQTT 消息跨云通信复杂且效率低下。集群连接提供了一个优化的内置解决方案，可在这些不同的云集群之间**高效可靠地路由 MQTT 消息**。无论用户连接到哪个云平台，都能确保消息从发布者准确地传递给用户。

- **实现真正的多云架构并减少供应商锁定：**

  如果没有集群连接功能，跨多个云的 EMQX 部署仍将是孤立、独立的集群。**集群连接是实现真正、统一和协作式多云 MQTT 基础架构的关键组件。**通过这种互联性，企业可以避免过度依赖单一云供应商，从而更灵活地选择最合适、最具成本效益的云服务来满足其需求。

- **简化运维：**

  在不同的云环境中手动管理消息同步和路由非常复杂，而且容易出错。**集群连接功能将这一复杂性抽象化，简化了多云部署的操作和维护流程，并提高了可控性。**

## 多云集群连接实例

本节演示了如何在多个云提供商之间部署 EMQX 集群。请注意，本演示侧重于在同一 EMQX 平台账户下的集群连接。有关跨不同账户或链接到自托管服务器的详细说明，请参阅[官方文档](https://docs.emqx.com/zh/cloud/latest/cluster_linking/cluster_linking.html)。

### 前提条件

1. 在不同的云平台创建两个专用部署：`deployment-aliyun` 和 `deployment-huawei`。有关设置专用部署的详细步骤，请参阅 [EMQX Cloud 文档中有关创建部署的说明。](https://docs.emqx.com/zh/cloud/latest/create/dedicated.html)
2. 确保通过 [NAT](https://docs.emqx.com/zh/cloud/latest/vas/nat-gateway.html) 网关访问公网：
   - 每个部署都必须设置 NAT 网关。
   - NAT 网关必须处于 `Running` 状态，并允许外部连接。

### 创建集群连接

1. 在 `deployment-aliyun` 控制台中打开**「集群连接」**页面。

2. 单击**「新建」**以创建新的集群连接。

3. 在新建集群连接页面上，配置以下选项：

   - **集群连接类型**：选择**同账号**。
   - **集群名称**：选择要链接到的 `deployment-huawei` 专用部署。
   - **地址**：要链接的部署的 MQTT 主机和端口，会根据所选部署自动填充。
   - **用户名/密码**：使用 `deployment-huawei` 配置的有效凭据来验证连接。
   - **客户端 ID 前缀**：为客户端 ID 设置唯一的前缀，例如 `from-aliyun`。

   根据集群规模和配置，可能会建立多个 MQTT 客户端连接到 `deployment-huawei`，每个客户端必须具有唯一的 ClientID。您可以通过设置这些连接的客户端 ID 前缀*，*例如：`from-aliyun-1`，来控制这些 ClientID 的分配方式。

   - **主题**：MQTT 主题过滤器列表，指定当前部署将从远程部署接收哪些消息，例如 `from-cluster`。
   - **高级设置**：配置其他设置，例如 [MQTT 协议](https://www.emqx.com/zh/blog/the-easiest-guide-to-getting-started-with-mqtt)参数。

4. 点击**确认**。新的链接将出现在**集群连接**页面上，并默认启用。

   ![image.png](https://assets.emqx.com/images/5fca23d099b62ae68840da31a798742d.png)

5. 在 `deployment-huawei` 重复此过程，创建返回 `deployment-aliyun` 的反向链接。

   ![image.png](https://assets.emqx.com/images/0b29bac4e38209ba99b3dd14c850e089.png)

### 技术原理

集群连接建立后，EMQX 使用 MQTT 协议在集群之间桥接消息。例如，当连接到 `deployment-aliyun` 的客户端向 `from-cluster` 主题发布消息时，EMQX 会通过配置的链接将其路由到 `deployment-huawei` 集群，确保两个集群上的订阅者都能收到该消息。此过程利用 MQTT 的轻量级发布-订阅模型实现高效的实时通信。

### 验证多云集群连接

要确认集群连接成功，请使用免费 MQTT 客户端工具 MQTTX 用于测试连接：[MQTTX 下载](https://mqttx.app/zh/downloads) 

1. 在 MQTTX 中创建名为 `aliyun-connection` 的连接，使用其 MQTT 主机和凭据连接 `deployment-aliyun`。
2. 创建第二个名为 `huawei-connection` 的连接，连接到 `deployment-huawei`。
3. 将两个客户端订阅到集群连接期间配置的 `from-cluster` 主题。
4. 使用 `aliyun-connection`，向 `from-cluster` 发布测试消息（例如：“来自阿里云的问候”）。
5. 验证 `aliyun-connection` 和 `huawei-connection` 是否接收消息，确认跨云的双向消息路由。

## 网络互联解决方案

为了在跨不同云平台的 EMQX 集群之间的实现无缝通信，强大的网络互连解决方案至关重要。本节探讨了三种常见方案：NAT 网关、VPN 连接和专线/云互联，重点介绍它们的优缺点和理想用例，帮助您为多云 MQTT 部署选择最佳方案。

### 默认 NAT 网关

网络地址转换（NAT）网关是跨不同云平台连接 EMQX 集群的默认方法。它通过公网 IP 路由流量，隐藏私有 IP 地址，同时支持互联网访问。这种方法设置简单，适合需要快速连接的小型企业或概念验证部署。

- **安全性**：由于流量通过公共网络传输，因此必须采取如防火墙、VPN 或加密等强大的安全措施，以保护数据安全。
- **性能**：由于翻译和路由流量的开销，NAT 连接通常会有延迟。与专用网络连接相比，它可能无法提供最佳性能。
- **用例**：非常适合初创企业或小规模物联网部署，在成本可控的前提下，提供低到中等的性能。

### **VPN 连接**

对于希望确保云环境之间通信安全的企业来说，虚拟专用网络（VPN）隧道提供了一种可靠的解决方案。通过在云供应商的虚拟专用云（VPC）之间创建加密隧道，VPN 可提供安全稳定的连接。这种方法非常适合需要为工业传感器网络等物联网工作负载提供安全、经济高效通信的中型企业。

- **安全性**：加密隧道确保云平台之间的所有流量保持私密并免受外部威胁。
- **稳定性**：VPN 通常比基于公共互联网的连接更稳定，并且可以支持多种流量类型。然而，它们仍然依赖于公共互联网，这意味着拥塞或路由效率低下可能会影响性能。
- **用例**：最适合需要安全、可靠连接且无需承担高昂专用网络成本的中型企业。

### **直接连接 / 云互连**

对于需要高性能连接的企业，**直接连接**或**云互联**可在数据中心和云环境之间提供专用的私有网络连接。虽然这些解决方案成本较高，但它们绕过了公共互联网，具有显著优势。这种解决方案是关键物联网应用的理想选择。

- **性能**：与 NAT 或 VPN 解决方案相比，直接专用连接可提供更高的带宽、更低的延迟和更可靠的性能，非常适合构建关键任务应用程序。
- **服务水平协议（SLA）**：这些解决方案保证了正常运行时间的 SLA，这对于具有严格可用性要求的企业来说至关重要。
- **成本**：较高的成本使其适合优先考虑性能而非预算的大型企业。
- **用例**：最适合需要 SLA 低时延和拥有高吞吐量 IoT 应用程序的企业。

## 结论

**EMQX 集群连接**功能对于确保无缝多云部署、高可用性和业务弹性至关重要。通过支持灵活的跨云迁移、跨平台路由消息以及提供高效、统一的 MQTT 基础设施，它使企业能够摆脱供应商锁定，增强灾难恢复能力并简化运营。最终，集群连接简化了多云管理的复杂性并确保了业务连续性，使其成为构建强大而灵活的物联网架构的重要组成部分。



<section class="promotion">
    <div>
        咨询 EMQ 技术专家
    </div>
    <a href="https://www.emqx.com/zh/contact?product=solutions" class="button is-gradient">联系我们 →</a>
</section>
