## 摘要

[V2X（Vehicle to Everything）](https://www.emqx.com/zh/blog/what-is-v2x-and-the-future-of-vehicle-to-everything-connectivity)，是指车辆通过网络与周围一切事物相互连接和通讯。这包括汽车与其他汽车的连接（V2V）、汽车对基础设施（V2I）、汽车对网络（V2N）、汽车对行人（V2P）。

车路协同是 V2X 概念的一个子集，更加专注于车辆、道路基础设施、云平台之间的之间的通信。车辆通过与云控平台及路侧智能通信设备进行交互，车辆可以共享位置及行驶状态等信息，同时，云平台基于道路基础设施的数据，也可以向车辆提供实时信息，如交通信号、路况、事故和施工信息，帮助驾驶员做出更明智的决策，减少交通事故的风险，提升交通效率。

随着车和道路基础设施都越来越智能，V2X 车路协同系统的应用场景也愈加广泛，如智慧交通、智能驾驶、智慧物流等领域。车路协同是智能汽车和智慧交通的重要发展方向，近年来，我国陆续颁布数字交通、交通强国等政策，让车路协同更成为智能汽车和智慧交通行业的热门话题。

然而，作为车路协同系统的核心，车路协同云控平台的建设面临着诸多挑战，如数据安全、高并发处理、实时性要求等问题。EMQ 的物联基础设施方案能够解决车路数据采集、汇聚、传递、计算、存储及管理等方面诸多挑战，让客户可基于此架构快速构建车路协同的云控平台。

## **车路协同云控平台建设面临的挑战**

目前的车路协同云控平台建设方案中，主要包含数据模块、V2X 消息转发、云控可视化、运维管理等功能模块，云控基础平台基础能力主要分为：资源连接、数据处理和数据共享。

- 资源连接层负责与车辆、路侧边缘计算单元、路侧通信单元以及外部数据源进行对接，包括接入管理功能和数据采集功能；
- 数据处理层主要提供对各类数据的初步清洗、存储，并将数据与主题相关联，使数据进入相应的主题数据库；
- 数据共享层主要提供物理数据、能力数据、用户数据等相关的主题数据库，供数据分析层调用。

这些能力要求，在未来大规模建设、商业化提速的新阶段，对云控基础平台的构建提出了诸多挑战。

**海量设备的高并发、高可靠、低时延连接**

未来车路协同系统中，云控平台需要接入包括路侧感知设备、路侧计算单元、路侧通信单元以及车载通信单元在内的大量设备。另外，车路协同场应用场景 20-100ms 的应用时延要求，也对高并发连接后消息吞吐的性能提出极高挑战。

**路侧感知数据的归一化治理**

目前行业内路侧计算单元构化感知结果的输出，尚未形成统一标准，不同厂商的路侧计算单元输出格式往往存在差异，尤其在一些多厂商设备分区域部署的项目中，如何在数据接入层面就解决路侧数据的归一化治理、存储，往往是项目中云控平台会遇到的难题。

**海量流式数据的计算、存储、分发**

车路协同每种设备的多种类型数据都以 1-10Hz 的频率上传，云控基础平台需要对不断流入的动态数据流进行实时处理，并向车端实时下发结果、向云端其他应用分发、持久化用于后续分析展示等。而当前基本的方案都要涉及多个分布式组件，极大增加了云控平台的开发难度、运维难度及可靠性。

**高效灵活的数据分类管理及访问管控**

在多路口、多设备、多数据类型的未来车路协同实际落地系统中，路侧感知结构化数据、云控平台生成的 V2X 应用消息通常需要按照消息类型、路口、设备、厂商等维度进行高效的数据隔离管理、访问控制，以方便上级应用灵活地提取数据数据，这对应用场景的实现、平台功能的实现至关重要。

**大量设备及数据的高效运维管理**

车路协同系统对业务应用的稳定性、连续性有高要求，云控平台需要对设备在线状态、数据流入流出状态进行全局监控。项目中有的路侧设备不支持直接上报状态，平台在设备及数据的实时监管、系统问题排查方面存在困难，平台和设备间需要额外协商和开发相关协议又会增加两侧的工作量。

**设备接入安全保障**

车路协同系统涉及道路交通信息、车辆信息甚至交通及车辆的控制，信息安全至关重要，设备接入云控平台之前，在保证通道安全的基础上，云控平台也需要通过设备秘钥、证书、身份认证等手段保障系统入口安全。

## **EMQ 解决方案助力 V2X 云控平台构建**

### **MQTT 协议在车路协同的应用优势**

在车路协同系统中，路侧上传的数据以及车路云交互的 V2X 消息均为结构化数据，单条数据不大，但频率高、数量多。多个不同的系统应用可能会需要按照消息类型、路口、设备、厂商等不同维度对同一设备上传的数据进行消费取用，反向往往也需要按照路口维度将不同 V2X 应用消息下发给多个设备。

[MQTT](https://www.emqx.com/zh/blog/the-easiest-guide-to-getting-started-with-mqtt) 是基于发布/订阅模式的物联网通信协议，提供灵活的多级主题定义，支持基于主题的灵活订阅发布，报文结构紧凑且 Payload 格式灵活，提供三种可选的 QoS 等级，提供在线状态感知及会话保持能力，这些特点能够很好地满足车路协同系统需求，为云控基础平台及其应用实现带来很多便利。因此，虽然标准层面并未规定 TCP 之上需要使用 MQTT 协议，但越来越多的车路协同示范项目以及一些 V2X 开源架构项目中，MQTT 协议已经成为主要的车云间、路云间交互协议。

### EMQ 物联基础方案解决 V2X 云控平台挑战

EMQ 车路协同整体解决方案建立在 MQTT 消息采集和传递框架之上，利用 [EMQX Enterprise](https://www.emqx.com/zh/products/emqx) (分布式 MQTT 消息服务器，以下简称 EMQX) 和 [HStream Platform](https://hstream.io/zh) （创新的流处理数据平台）打造系统数据中枢，解决车路数据**采集、汇聚、传递、计算、存储及管理等方面诸多挑战**，让客户可基于此架构快速构建车路协同云控平台的资源连接层、数据处理层，并实现这两层与数据共享层的衔接。

![EMQ 车路协同整体解决方案](https://assets.emqx.com/images/e3cc8f55183abc08da1dc7b0e0af3d2c.png)

其中，作为基于 MQTT 协议标准的云原生分布式物联网接入平台，EMQX 为实现车路协同高性能、高可靠的实时数据采集、移动、处理和集成提供动力：

**多协议设备接入能力**

除了支持 MQTT 3.1/3.1.1/5.0，同时支持 LwM2M、CoAP、MQTT-SN 或 TCP/UDP 私有协议接入，支持车载通信单元通过 MQTT 或 JT-808/GBT-32960 车联网专业协议接入，能适应项目中不同的设备协议，实现全量设备统一接入。

**千万级并发连接、百万级数据吞吐、毫秒级实时消息路由**

基于高可用、分布式集群架构，支持百万到亿级海量并发连接、毫秒级软实时消息路由、百万级 TPS 数据吞吐，满足城市级规模车路系统在「路侧-云端-车端」之间的双向移动。

**强大规则引擎实现接入数据预处理归一化**

提供内置的规则引擎，在接收车路设备数据后，通过 SQL 语句低代码形式就可以创建规则将来自不同设备、结构有差异的感知数据进行实时数据编解码、筛选、聚合、模板归一化，再根据不同应用需求，将处理数据零代码、高性能桥接集成到多种消息队列及 SQL / NoSQL / 时序列数据库。

**多种接入认证保证系统安全**

支持 TLS/SSL（包含国密算法）双向认证、内置/外置账密数据库源认证、一机一密方案适配，以及扩展与第三方 C-V2X CA 认证平台进行认证对接。

**支持灵活的消息分发及管控**

通过 MQTT 基于主题的发布/订阅模式进行消息传递，能够支持车路数据按照类型、所属路口、设备厂商等多维度进行灵活分类和路由转发，访问控制机制能够对不同终端进行信息发布和订阅的权限控制，方便上层应用调用数据和管理数据。

**提供丰富的 API 供上层应用平台集成**

V2X 消息转发模块可以通过消息发布、主题订阅等接口基于 EMQX 强大性能实现 V2X 消息高并发转发；数据监控应用可通过 API 获取连接数、订阅数、消息流量监控，运维管理可通过上下线消息通知实时掌握设备运行情况。

HStream 能够对 EMQX 输入的数据进行高效存储、管理、动态实时分析：

- 轻松支持存储和管理大规模的数据流，数据以流为单位进行组织和访问，在大量数据流并发读写的情况下仍然能够保持稳定的读写延迟。
- 完整的基于事件时间的状态化处理方案，支持过滤、转换、聚合以及基于多种时间窗口的计算，同时也支持乱序和晚到消息的特殊处理，保证 V2X 业务数据计算结果的准确性、稳定性。
- 轻松灵活的数据集成，提供了多种常用上下游服务和数据系统对接，方便用户和外部数据系统进行集成开发应用。

## 方案价值

**赋能 V2X 消息生成和下发**

V2X 消息生成和下发负责将路侧交通情况、交通事件等数据与车辆上报的基本信息进行分析、匹配、下发应用消息。该模块可以从 HStream 中实时消费 EMQX 汇聚的路侧上传的交通参与者感知数据、交通流数据、交通事件数据，生成业务下行消息；再通过调用 EMQX 消息订阅发布能力将应用场景消息下发给相应的车载 OBU 或路侧单元。OBU 解析消息内容，通过车上的人机交互设备完成信息内容的传递实现辅助驾驶，或将传递信息内容给自动驾驶计算系统实现感知辅助。

**赋能云控可视化**

云控可视化功能通常基于电子地图或高精度地图实现交通元素孪生展示、云控事件告警、大数据分析、数据看板，该功能模块可以从 HStream 中实时消费 EMQX 汇聚的路侧上传的交通参与者数据，各类交通事件 RSI 消息，或其历史数据，用作大数据分析。

云控模块还可以调用 EMQX 丰富的消息吞吐统计 API，轻松实现云控平台上下行消息统计、不同时间维度的消息吞吐统计展示。

另外，EMQX 的客户端上下线事件通知、客户端详细信息查询 API 等，可以支撑云控平台设备状态监管、路侧设备注册管理、车辆注册管理等运维管理功能。

**灵活部署**

在不同项目中，EMQ 的云控基础设施解决方案能够根据客户需求适配物理机、容器/K8s、私有云、混合云及公有云多种部署方式，与客户应用系统部署在同一环境中，帮助客户快速实现不同项目中多厂商不同设备数据统一接入、汇聚和移动，快速搭建高性能、高可靠、多功能的车路协同云控平台。

**赋能未来「多级云控」架构**

EMQX 具备灵活的数据桥接能力，当作为云控基础平台的接入平台时，能够连接部署在其他区域及云端的其他多个 EMQX 或者其他 MQTT 消息中间件，支持设定规则把指定主题的消息转发至桥接节点，桥接节点收到消息后在本节点/集群中转发该消息。

## **相关产品**

### EMQX Enterprise

作为基于 MQTT 协议标准的云原生分布式物联网接入平台，EMQX Enterprise (以下简称 EMQX) 能够解决海量车端记录册设备接入、高并发上下行数据吞吐，为实现车路协同高性能、高可靠的实时数据采集、移动、处理和集成提供动力。EMQX 通过以下能力为用户带来收益：

- 高可靠性和可扩展性：EMQX 采用分布式架构，具有高可用性和可扩展性，可以处理大规模并发消息传输。它支持水平扩展，以适应不断增长的物联网设备和数据流量，确保系统稳定性。
- 丰富的协议支持：除了 MQTT 协议外，EMQX 还支持多种消息传输协议。它允许开发人员扩展以支持各种私有协议，以满足其应用需求。
- 数据集成：EMQX 与各种数据存储服务、消息队列、云平台和应用无缝集成。它可以连接到云服务，实现远程数据传输和基于云的分析。
- 安全和认证：EMQX 提供强大的安全功能，包括TLS/SSL加密传输、客户端认证和访问控制。它支持多种认证方法，如用户名/密码、X.509证书和OAuth，确保物联网通信的安全性。
- 规则引擎和数据处理：EMQX 具有灵活的规则引擎，可以基于设备数据进行实时数据处理和转发。它支持数据过滤、转换、聚合和持久化等操作，帮助用户根据业务需求进行分析和决策。
- 可视化监控和管理：EMQX 提供直观的可视化监控和管理界面，允许用户实时监控物联网设备和消息传输。用户可以查看连接状态、消息流量和其他指标，还可以进行设备管理、故障排除和系统配置操作

<section class="promotion">
    <div>
        免费试用 EMQX 企业版
            <div class="is-size-14 is-text-normal has-text-weight-normal">无限连接，任意集成，随处运行。</div>
    </div>
    <a href="https://www.emqx.com/zh/try?product=enterprise" class="button is-gradient px-5">开始试用 →</a>
</section>

### HStream Platform

[HStream Platform](https://hstream.io/zh) 是一个高性能流式数据平台，能够对 EMQX 输入的数据进行高效存储、管理、动态实时分析，并实现轻松灵活的数据集成，通过多种常用上下游服务和数据系统对接，方便用户和外部数据系统进行集成开发应用。HStream 平台提供以下关键功能：

- 规模化摄取和存储数据流：实现从各种数据源产生的大量数据进行实时摄取。可将数百万规模的数据流可靠地存储在专门设计的分布式流数据存储集群中。
- 随时重放和消费数据流：通过订阅消息队列中的主题实时消费数据流，数据流可以被高效持久话，并可以随时回放和消费数据流。
- 流数据处理：通过内置数据处理函数，使用 SQL 语法进行数据过滤、转换、聚合，甚至连接多个数据流。
- 通过物化视图实现实时分析：通过从持续更新的数据流创建的物化视图，能够通过使用标准 SQL 语句进行简单的查询操作，从而获得实时数据洞察力。
- 丰富的上下游数据集成：内置多种上下游数据系统的无缝集成，包括 Kafka，MySQL，Postgresql，MongoDB 等，并提供可扩展的数据系统对接能力。



<section class="promotion">
    <div>
        咨询 EMQ 方案专家
    </div>
    <a href="https://www.emqx.com/zh/contact?product=solutions" class="button is-gradient px-5">联系我们 →</a>
</section>
