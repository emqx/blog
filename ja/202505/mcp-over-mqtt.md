## はじめに

大規模言語モデル（LLM）の普及に伴い、最適なユースケースの選定や、さまざまな業界で活躍できるインテリジェントエージェントの構築が課題となっています。コミュニティでは AI エージェント開発を支援するインフラとツールが急増しており、その中でも Anthropic の **MCP** は、多様なデータソースと LLM の接続を可能にする点で注目されています。

本記事では、以下の問いを通じて MCP が IoT インテリジェンスを推進する可能性と応用について探ります。

- MCP を活用して膨大な数のデバイスにインテリジェンスを付与できるか？
- IoT シナリオで MCP を適用する際の制限はあるか？
- MQTT と MCP の連携により、レガシー機器と新規デバイスの双方を AI エコシステムにシームレスに接続できるか？

## MCP の概要

**MCP（Model Context Protocol）** は Anthropic が 2024 年 11 月に発表したオープンスタンダードプロトコルで、LLM と外部データソース・ツール・サービス間の標準化された通信フレームワークを提供します。データサイロを解消し、マルチソース情報とのインタラクション効率を高めることを目的としています。主なアーキテクチャとコンポーネントは以下のとおりです。

- **MCP ホスト**：リクエストを発行する LLM アプリ（例：Claude Desktop、IDE ツール）
- **MCP クライアント**：ホスト内で動作し、サーバーと 1 対 1 の接続を維持するプロトコルクライアント
- **MCP サーバー**：コンテキスト・ツール・プロンプトを提供する軽量プログラムで、ローカル・リモート両方のリソース（ファイル、DB、API など）へアクセス可能

**MCP の主な利点と特徴**

- **開発の簡素化**：一度実装すれば複数のツールと統合可能で、都度カスタムコードを書く必要がない
- **動的インタラクション**：リアルタイムでコンテキスト更新ができ、応答効率を向上
- **セキュアで制御可能**：組み込みのアクセス制御により、LLM は明示的に定義された操作のみ実行
- **柔軟な拡張性**：新機能は追加の MCP サーバーをデプロイするだけで拡張でき、プラグインのようなモジュール化が可能

**MCP の AI 応用シナリオ**

- **インテリジェント IDE**：コードリポジトリやドキュメントと連携し、コンテキスト認識型のコーディング支援を実現
- **データ分析**：ローカル DB へ安全にアクセスし、SQL クエリや自動レポート生成をサポート
- **ワークフロー統合**：CRM・ERP などエンタープライズシステムと連携し、複雑なタスクを自動化

リリース以降、MCP 関連のサーバーサービスは急速に拡大しています。現在、[MCP Server Directory](https://mcp.so/servers) には 4,245 件のサービスが掲載されており、データベースやクラウドプラットフォーム、ブラウザオートメーションなど多岐にわたります。これらのサービスにより、MCP クライアントアプリは外部データソースやツールと容易に接続でき、AI の推論能力を活用したワークフローのオーケストレーションとインテリジェントアプリ開発を促進できます。

## **MCP の IoT アプリケーションでの可能性**

IoT デバイスはデータを報告することで物理環境をデジタル化し、公開インターフェースを通じて機器を制御することでユーザーのニーズを満たします。現在、多くの IoT システムは通信に [MQTT プロトコル](https://www.emqx.com/en/blog/the-easiest-guide-to-getting-started-with-mqtt) を採用しています。MCP のアーキテクチャは IoT の **「デバイスモデル」** 概念と密接に一致しており、この領域で有望なソリューションとなります。MCP は既存の MQTT ベースシステムとシームレスに統合できるだけでなく、デバイスと AI アプリケーション間の接続を強化します。

**デバイスモデルの紹介**

デバイスモデルは、物理エンティティ（センサー、車載デバイス、建物、工場など）のデジタルツインをクラウド上に表現するものです。以下の 3 つの次元で特性・機能・外部公開情報を定義します。

- **属性（Attributes）**：デバイスのリアルタイム状態データ（例：温度・湿度、スマートデバイスの ON/OFF 状態）
- **関数（Functions）**：デバイスが実行可能なコマンド。入力パラメータ（実行条件）と出力パラメータ（実行結果）をサポート（例：エアコンの温度設定、モーターの起動／停止）
- **イベント（Events）**：クラウドへ能動的に報告される情報（アラート、故障通知など）

**MCP が提供する機能**

- **リソース（Resources）**：API 応答やファイル内容などクライアントがアクセスできるデータ
- **ツール（Tools）**：ユーザーの許可を得て LLM が呼び出せる機能モジュール
- **プロンプト（Prompts）**：ユーザーのタスク支援を行う事前定義テンプレート

**MCP と IoT：AI 駆動 IoT システムへのシームレス統合**

デバイスモデルの 3 次元と MCP の機能を比較すると、明確な対応関係が見られます。

- **デバイスモデルの属性とイベント → MCP のリソース**：物理デバイスのメタデータとリアルタイム状態を LLM に提供
- **デバイスモデルの関数 → MCP のツール**：ユーザー許可の下で LLM が関連データ取得やデバイス操作を実行

この高い類似性により、AI ベースの IoT システムを構築する実現的アプローチが得られます。

- **デバイスメーカー**：自社デバイス向けに MCP サービスを提供、または既存のデバイスモデル API（HTTP など）を MCP サービスとしてカプセル化
- **スマホアプリなどのクライアント**：ユーザー要件に基づいてワークフローを定義／オーケストレーションし、MCP サービスを自動的に呼び出してデバイスを制御

MCP により AI がデバイスインタラクションを担うことで、エンドユーザーは自然言語で IoT デバイスとシームレスにやり取りできます。例えばスマートホームで、ユーザーがスマホアプリにこう指示するとします。

> **「1 時間後に帰宅するから、リビングを 25°C、湿度を 40% にしておいて。」**

従来、この機能を実現するには、異なるデバイスモデルやバージョンごとに個別のインターフェース適合が必要でした。
MCP を導入すれば、LLM（例：DeepSeek）がデバイスの能力を自然言語記述から **知的に理解** し、関連する MCP サービスを自律的に連携してデバイス制御を実行できます。**手動のルールやコードは不要** で、IoT エコシステムにおける **デバイス互換性と AI 自動化** を大幅に向上させます。

## **MCP を IoT に適用する際の制限**

MCP プロトコルは現在、主に **標準入出力（stdio）** と **HTTP + Server-Sent Events（SSE）** の 2 つの通信方式をサポートしています。前者はローカル通信、後者はリモート通信に適しています。

理想的な IoT デプロイメントでは、**MCP サーバーがデバイス上で稼働**し、モバイルアプリなどのクライアントが **MCP ホスト** となって **MCP クライアント** を介してサーバーとインテリジェントな連携を行います。しかし実際には以下の課題があります。

- **高いリソース要件**：HTTP・SSE は計算・ストレージを多く消費し、電力や処理能力が限られる IoT デバイスには不向き
- **不安定なネットワーク**：モバイル・遠隔・産業環境では通信が不安定で、サービスの継続性確保が困難
- **MQTT エコシステムとの互換性**：IoT 業界では MQTT が主流で、SSE を導入すると追加のアクセス制御が必要になり複雑化
- **プロトコルサポートの問題**：多くの IoT デバイスは **MQTT のみ対応** で、MCP 用に HTTP を追加すると実装が煩雑
- **スケーラビリティの課題**：IoT では **数万〜数十万台** のデバイスを扱うため、現在の MCP のクライアント直結モデルでは大規模運用に適さない

## **MCP over MQTT：提案ソリューション**

上記課題を解決するため、EMQ は **MCP over MQTT** ソリューションを提案します。これはプロトコルレベルで IoT デバイスのインテリジェンスを強化するものです。

コンピューティング能力の異なるデバイスに対して差別化したサポートを提供します。

- **リソース制約デバイス** 向け
  - **外部プロキシ**：EMQX 外部に **MCP サーバー** を配置し、MQTT で IoT データを処理しつつ、MCP クライアントとは MCP over MQTT で通信
  - **内部プロキシ**：**EMQX 内部** に MCP サーバープロキシを実装し、デバイス操作を代行
- **十分な計算・ストレージを持つデバイス** 向け
  - **ネイティブ実装**：**MCP over MQTT SDK** を用いてデバイス上にネイティブ MCP サーバーを実装

トランスポート層を **HTTP + SSE** から **MQTT** に置き換えることで、**帯域が狭い・ネットワークが不安定** な環境でも通信信頼性が向上します。さらにメッセージブローカー **EMQX** を介することで大規模展開に必要な以下の機能を提供します。

- **大規模 MCP サーバーのサービスディスカバリ**
- **組み込み認証・アクセス制御** によるセキュリティと安定性

### **外部プロキシソリューション**

![image.png](https://assets.emqx.com/images/229c17c2ab27546f059d9c1d6344188c.png)

- **MCP サーバー（デバイスプロキシ）**
  - デバイスは **MQTT** で **EMQX** にデータをアップロードし、**MCP サーバー** が該当トピックを購読してデバイス情報を取得。これを **MCP リソース** や **ツール** として公開
  - デバイス制御メッセージも MQTT 経由で送受信し、MCP over MQTT で外部システムにツールを公開
- **アプリ側**
  - アプリは **EMQX** を介して **MCP over MQTT** でリモート MCP サーバーと通信し、デバイス状態取得と制御を実施。標準 **MCP** プロトコルで他の MCP サーバーとも連携可能

主な利点は **既存 IoT デバイスの改修が不要** で AI 連携を実現できることです。MQTT の **低電力・低ネットワーク** 環境でのメリットを保ちつつ、EMQX の **高並列・高可用性** と組み合わせ、大規模なインテリジェント IoT の迅速展開が可能です。

### **内部プロキシソリューション**

![image.png](https://assets.emqx.com/images/21a0020e1593bbf03ab51d917d2644dc.png)

**内部プロキシ** は外部プロキシを発展させ、**MCP サーバー** を **EMQX** に直接統合します。単にノード数を削減するだけでなく、組み込みツールや機能を通じてシステム性能を強化します。MCP サーバーが EMQX の内部コンポーネントとして動作するため、運用の複雑さを大幅に軽減し、開発と管理が容易になります。

### ネイティブソリューション

![image.png](https://assets.emqx.com/images/06f1c4318b66d1cd41e06e55e39ceccd.png)

**ネイティブソリューション** は、スマートカーや 3D プリンタなど高性能デバイス向けです。デバイス上に **MCP** をネイティブ実装し、**MCP over MQTT** で **EMQX** と直接通信します。クライアントアプリは標準化された MCP over MQTT を通じ、デバイス内の **MCP クライアント** と直接やり取りし、エンドツーエンドの知的制御を実現します。

例として、2 台の 3D プリンタが以下のサービス名を持つとします。

- `3D-Printer/ACH301/EECF7892AB1`
- `3D-Printer/ACH301/CAED99C2EE2`

ここで `3D-Printer/ACH301/` がデバイスタイプ、`EECF7892AB1` と `CAED99C2EE2` がデバイス ID です。クライアント（モバイルアプリ）はユーザー権限を確認した上で該当トピックを購読し、`ACH301` プリンタに利用可能なツール（機能）を取得してインテリジェントにデバイスを操作します。

この新しいインテリジェント IoT プラットフォームアーキテクチャは **M2M（Machine-to-Machine）** シナリオに最適です。デバイスメーカーは完全な **MCP サーバー**（推奨プロンプトテンプレート含む）をデバイスに組み込み、IoT プラットフォームは各デバイスごとに個別コマンドを実装することなく、クライアントアプリ経由で統一的にアクセスできます。

- デバイスメーカー：デバイス側機能の実装に注力
- IoT プラットフォーム：インテリジェントクライアント（音声対話含む）のユーザー体験向上に注力

## **MCP over MQTT プロトコル概要**

### **特徴**

MCP over MQTT は元の MCP 機能を強化し、以下を追加します。

- **サービスディスカバリ**：MQTT の保持メッセージとラストウィルを利用し、**MCP クライアント** が利用可能な **MCP サーバー** を自動検出
- **サーバーの線形スケール**：MQTT の共有購読により、**MCP サーバー** をステートフルのまま線形スケールアップ／ダウン
- **集中認証**：MQTT ブローカーを中央メッセージミドルウェアとすることで、成熟した認証・認可ソリューションを利用可能

将来的には MQTT ブローカーに **MCP サーバープラグイン** を統合し、MCP サーバーのデプロイをさらに簡易化し、データ転送効率を最適化する計画です。

### **制限**

**MCP over MQTT** は主に **リモート配置の MCP サーバー** を想定しています。中央 MQTT ブローカーを前提としたアーキテクチャのため、ローカル配置でも利用できますがデプロイが複雑になる可能性があります。

## **まとめと展望**

EMQ は現在、MCP over MQTT の初期検証を完了し、プロトタイプシステムを構築しました。R&D チームはプロトコルアーキテクチャの標準化とエンジニアリング実装に注力しており、次フェーズでは主要技術コンポーネントの詳細検証と性能最適化を進めます。

将来的には、このソリューションが IoT の **エージェンティック時代** を切り拓くと期待されます。EMQX MQTT プラットフォームがプロトコル適応と集中サービス管理を担い、データサイロと断片化を解消。一方 LLM は自然言語理解と推論によりユーザー意図を動的にデバイスアクションへ変換します。この強力な組み合わせにより、企業は多種多様なヘテロジニアスデバイスを MCP ベースの AI エコシステムにシームレス統合し、レガシーシステムのアップグレードコストを削減しつつ、さまざまなシナリオでインテリジェントアプリを迅速に開発できます。MCP over MQTT に支えられ、IoT は単なる相互接続からインテリジェントな協調へと進化し、企業のデジタルトランスフォーメーションの道筋を再定義します。

IoT と AI の交差点で次世代インテリジェントソリューションを探求し続ける EMQ の最新技術アップデートにご期待ください。ご興味がある方はぜひお問い合わせください！



<section class="promotion">
    <div>
        専門家と話します
    </div>
    <a href="https://www.emqx.com/ja/contact?product=solutions" class="button is-gradient">お問い合わせ →</a>
</section>
