## はじめに

**MQTTX Copilot** に **Claude 3.7 Sonnet** が統合されました。  この強力な追加機能により、MQTT テストワークフローにインテリジェントなコード生成が組み込まれます。

MQTT テストでは、現実的なデータペイロードの作成、メッセージ変換、処理ロジックの実装など、手間と時間のかかる作業が頻繁に発生します。Claude 3.7 Sonnet は高度なプログラミングパターン理解に基づくコード生成を得意としており、カスタム関数やデータスキーマを即座に生成して IoT 開発・テストを大幅に高速化します。

## 使い始める

Claude 3.7 Sonnet を有効にするには、MQTTX の設定ページで AI 設定セクションの「モデル」から Claude 3.7 Sonnet を選択します。まだ MQTTX Copilot を設定していない場合は、設定パネルに API キーを入力してください。

![image.png](https://assets.emqx.com/images/cd330887e413bea5fe0447b1bd4c7a4a.png)

設定が完了したら、MQTTX を開き「Script」ページへ移動し、インターフェース内の **MQTTX Copilot** ボタンをクリックします。これで Claude 搭載のコード生成機能を MQTT テストシナリオで直接利用できます。

![image.png](https://assets.emqx.com/images/0f13351028ac9218a4a22c654d39ae90.png)

![image.png](https://assets.emqx.com/images/3561630506622f015bfcec01b5b6fd71.png)

## 主要機能

### インテリジェントコード生成

MQTTX Copilot には、MQTT テストを効率化する強力なコード生成機能があります。すぐに使えるプリセットテンプレートと、ニーズに合わせたカスタム生成の両方を提供します。

プリセットテンプレートを使用すると、一般的なテストシナリオのコードをワンクリックで生成できます。

- **天気データのシミュレーション**: 温度や湿度などの範囲を設定し、ランダムな揺らぎを加えた現実的なセンサデータを生成します。
- **コマンドの動的切り替え**: メッセージのインデックスやトリガーに応じてコマンド状態を自動的に切り替える関数を生成します。デバイス制御シーケンスや状態遷移のテストに最適です。
- **時刻フォーマット処理**: Unix タイムスタンプをタイムゾーン対応の可読な文字列に変換します。複雑な変換ロジックを自動化し、データ解析を容易にします。

![image.png](https://assets.emqx.com/images/6404e6b4604893a1431ed64f6c3151f1.png)

自然言語で要件を入力するだけで、MQTTX Copilot がシナリオに合わせたカスタムコードを生成します。生成された関数は業界のベストプラクティスに従い、エラーハンドリングや入力バリデーション、処理ロジックを説明するコメントが含まれます。

### スキーマ生成

Protobuf と Avro 形式のスキーマを自動生成し、MQTT テストメッセージを効率的に構造化できます。メッセージ形式の標準化により、データ整合性を確保し、ペイロードサイズを最適化して通信効率を向上させます。

MQTTX Copilot は、代表的な IoT シナリオ向けに完全なスキーマを即座に生成できます。

- **スマートホームデバイスのステータス報告**: デバイス状態、センサ値、システムステータスを整理したフォーマット。
- **産業機器のアラームメッセージ**: アラートレベル、エラーコード、タイムスタンプ、周辺情報を含む標準化フォーマット。
- **コネクテッドカーのテレメトリデータ**: GPS 座標、速度、燃料／バッテリー残量などの包括的データ構造。
- **スマートメーターのリアルタイム計測**: 電力消費量、電圧、時系列データを正確に定義したスキーマ。

![image.png](https://assets.emqx.com/images/48464e7124db19fd6b23c1c10d737bbf.png)

各スキーマには詳細なフィールド定義、適切なデータ型、必須／任意フィールドの区別が含まれ、サンプルデータも付属するためすぐにテストを開始できます。カスタム要件がある場合は自然言語でデータ構造を記述するだけで、要望に合ったスキーマ仕様が生成されます。



![image.png](https://assets.emqx.com/images/bd43a4dd3304437c2091acfd5c847e3d.png)

生成されたコードやスキーマは、コードブロック右上の **「Insert」** ボタンをクリックするだけでエディタに挿入でき、そのままテストやカスタマイズを開始できます。

## エンドツーエンドの IoT デバイスシミュレーション

以下では、MQTTX Copilot が IoT アプリケーションのテストプロセスをどのように効率化するか、具体例を通じて説明します。

**スマートサーモスタットのテストシナリオ**

スマートホームプラットフォームを開発しており、複数のサーモスタットからのデータを処理する必要があるとします。以下の手順で数分以内に包括的なテスト環境を構築できます。

1. **データ処理関数を生成**
   - MQTTX Copilot のカスタムコード生成を選択します。
   - リクエスト:  「温度読み取り値、設定温度、HVAC モード（heat/cool/off）、湿度、バッテリー残量を含むスマートサーモスタットデータをシミュレートする関数を生成してください。現実的な揺らぎと時折発生する異常値も含めてください。」
   - 生成された JavaScript 関数を MQTTX スクリプトエディタに挿入します。
2. **メッセージスキーマを作成**
   - MQTTX Copilot のスキーマ生成機能を使用します。
   - リクエスト:  「温度、設定温度、HVAC モード、湿度、バッテリー残量を含むスマートサーモスタットデータ向けの Protobuf スキーマを生成してください。適切なデータ型とフィールド番号を設定してください。」
   - 生成されたスキーマを確認し、メッセージ構造を標準化します。
   - スキーマをプロジェクトに挿入して参照・実装します。
3. **テストを実行**
   - MQTTX でスクリプトを実行し、シミュレートされたサーモスタットデータを発行します。
   - 関数が自然な変動を含むリアルなデータを生成する様子を確認します。
   - MQTTX のメッセージビューでフォーマットされたメッセージを観察します。
   - アプリケーションがさまざまなデバイス状態にどのように反応するかを分析します。

![image.png](https://assets.emqx.com/images/9c0bd2a16f70d355ad09b81f56129ba6.png)

![image.png](https://assets.emqx.com/images/d5bb66112faa4aeb13ce73368ca1cc0d.png)

![image.png](https://assets.emqx.com/images/b1a6064fac2febbf1329b9efdd6ccae9.png)

この統合アプローチにより、複雑なテストシナリオを迅速に構築し、スキーマでメッセージフォーマットを一貫させながら、リアルなテスト環境を作成できます。

## AI 搭載ツールで MQTT テストを加速 — 今後も機能拡充予定！

Claude 3.7 Sonnet と MQTTX Copilot の統合により、テスト関数生成・データペイロード生成・スキーマ開発が自動化され、MQTT テストの準備時間を大幅に削減できます。

本機能は MQTTX バージョン **1.12.0** で正式リリース予定です。Claude 3.7 Sonnet に加え、DeepSeek や Grok など複数の先進 AI モデルにも対応しており、ニーズに合わせて最適なモデルを選択できます。

今後のリリースでは、AI エージェント機能の高度化や **MPC (Model Context Protocol)** の統合を計画しており、さらに高度な AI 機能を提供していきます。

EMQX での AI 活用や特定の AI シナリオにご興味がある場合は、ぜひ弊社までお問い合わせください。MQTT 開発ワークフローにおける AI 活用の新たな可能性を一緒に探求しましょう。
