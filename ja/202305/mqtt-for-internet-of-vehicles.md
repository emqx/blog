「Internet of Vehicles（IoV）」は、輸送システムの分野でのIoT技術の代表的な応用例です。IoV産業に関連する技術分野の統合レイアウトと協調開発は、ある程度IoTと関連しています。オープンソースのIoTデータインフラストラクチャ・ソフトウェア・サプライヤーであるEMQは、長い時間にわたってIoV分野の多くの顧客にクラウドエッジコラボレーションを備えたIoTインフラストラクチャ・ソフトウェアを提供しています。これにより、人、車両、道路、クラウドを統一的に接続し、車両メーカー、T1サプライヤー、アフターマーケットサービスプロバイダー、旅行サービス会社などに対して、インテリジェントネットワーキング、自律走行、V2Xシナリオソリューションを作成することができます。

このシリーズの記事では、プロトコル選択などの理論的な知識から、プラットフォームアーキテクチャ設計などの実践的な操作まで、IoV分野でのEMQの実践的な経験に基づいて、信頼性の高い、効率的で業界固有のIoVプラットフォームを構築する方法を共有します。

## はじめに

MQTTプロトコルは、IoT分野で主流のプロトコルとなっています。軽量性、高効率性、信頼性、セキュリティ、双方向通信の特徴により、多くの産業のIoTプラットフォーム構築に広く使用されています。では、MQTTプロトコルはIoV産業においてどのように応用されているのでしょうか？

本記事では、EMQがIoV産業でのユースケースに基づき、IoVプラットフォーム構築における異なるIoT通信プロトコルの利点と欠点を比較し、企業が自社の状況に基づいて適切なMQTTメッセージング製品とサービスを選択する方法、およびデータ転送セキュリティ、データ統合などの最も人気のある技術的なソリューションを共有します。


## MQTTプロトコルはIoVに適しているのか？

IoVのビジネスアーキテクチャは複雑で、複数の通信リンクが関係しています。本記事では、IoVプラットフォームの主要な責任であるデバイスからクラウドへのメッセージングに焦点を当てています。

MQTTは、パブリッシュ/サブスクライブモデルに基づくIoT通信プロトコルであり、実装が簡単で、QoSサポートや小さなメッセージサイズなどの特徴があります。IoTプロトコルの半数を占めています。IoVシナリオでは、MQTTは依然として多数の車両システムの柔軟で迅速で安全なアクセスに適用され、複雑なネットワーク環境下でのメッセージのリアルタイム性と信頼性を確保します。MQTTの主な利点は以下のとおりです。

- 完全にオープンなメッセージプロトコルであり、実装が簡単です。市場には多数の成熟したソフトウェアライブラリやハードウェアモジュールがあり、車両のアクセス難易度とコストを効果的に削減することができます。
- 柔軟なPub/Subとトピック設計を提供し、大量のトピックを通じてメッセージを伝え、様々なIoVビジネスケースに対応することができます。
- Payload形式が柔軟で、メッセージ構造がコンパクトであり、様々なビジネスデータを運ぶことができ、車両のネットワークトラフィックを効果的に減らすことができます。
- 3つのオプションのQoSレベルを提供し、車両の異なるネットワーク環境に適応することができます。
- オンライン状態の認識とセッション管理の機能を提供し、車両のオンライン状態を管理し、オフラインメッセージを保持することができます。

まとめると、大量の車両接続を処理し、ソフトリアルタイムで高並行データスループットを扱い、多数のセキュリティ保証機能を持つメッセージングブローカー製品と一緒にMQTTプロトコルを使用すると、IoVプラットフォームの構築に便利です。

## なぜMQTTは他のプロトコルよりも優れているのでしょうか？

IoVの顧客のほとんどは、現時点ではMQTTプロトコルを好んで使用しています。私たちは、プライベートTCPやHTTPなど他のプロトコルを選択する顧客にも出会っていますが、IoVの使用例においてはMQTTが最良の選択肢となります。

MQTTプロトコルが開発される以前、中国南部の大手自動車メーカーは、プライベートTCPプロトコル（ACPプロトコル）を採用してIoVのサービスプラットフォームを構築しました。プロトコルの仕様設計と開発に長期間を費やした後、IoVプラットフォームの主要な機能が基本的に実現されました。しかし、IoVビジネスシナリオの需要が増加し、車両の数が増加するにつれて、プライベートTCPの欠点はより顕著になってきました。

プライベートプロトコルには以下のような問題があります。

・プライベートプロトコルの定義とバージョンの維持が困難である。

・プロトコルのすべての機能（キープアライブ、再接続、オフラインメッセージなど）がカスタマイズされ、開発される必要がある。

・プライベートプロトコルは、端末ハードウェア適応のカスタマイズ開発を必要とする。

・高コスト、長いサイクル、遅い更新イテレーションが目立つ。

MQTTプロトコルの持続的な改善とIoVプラットフォームの通信セクションでの広範な使用により、自動車メーカーは新世代のIoVプラットフォームの開発にMQTTプロトコルを採用し始めました。EMQXが提供するMQTTプロトコルの完全なサポートに基づいて、開発コストを削減し、開発サイクルを短縮し、より多くの機能シナリオとより良い運用・メンテナンスを実現することができます。

中国東部の大手自動車メーカーは、在庫に100万台以上の車両があります。以前のIoVプラットフォームは、プライベートTCPプロトコルを使用して構築されていました。数百万台の車両の大量のメッセージ通信のため、プライベートTCPプロトコルはメンテナンスコストが高く、メッセージの信頼性が保証されず、日常のシステムメンテナンスや機能開発の作業量が非常に多くなっていました。IoVプラットフォーム内でMQTTプロトコルが広く採用されるようになったことで、自動車メーカーもMQTTプロトコルへの移行とアップグレードを開始しました。現在、一部の車種がOTAでアップグレードされています。将来的には、段階的にすべての車種のアップグレードと変換を完了する予定です。

他の自動車企業の顧客は、開発初期段階で私たちに連絡しました。初期段階では、比較的単純なビジネスケースがあったため、カスタムインハウスのHTTPサービスを使用して車両にアクセスすることにしました。ビジネスが拡大するにつれて、従来のリクエスト-レスポンスモードの通信では新しいビジネス要件を満たせなくなりました。同時に、機能と端末の数が増えるにつれて、全体のプラットフォームのトラフィック量が指数関数的に増加し、HTTPアクセスを使用した場合にパフォーマンスとスケーラビリティの問題が発生しました。顧客は最終的に、アクセスプロトコルとしてMQTTを選択し、EMQXが提供するデータアクセスソリューションを使用してビジネス問題を解決しました。

全体的に、プライベートプロトコルは閉鎖性と排他性の特徴を持ちます。開発初期段階では、特定の問題を解決するために設計されており、将来的な柔軟性が欠けることがあります。ビジネスが拡大し、プロトコルでより多くの機能が必要になると、新しい要件を満たすことがしばしば困難になります。接続数が増えるにつれてパフォーマンスとスケーラビリティの問題が発生することがあります。その結果、開発は実際のビジネスニーズからアクセスレイヤーやミドルウェアの開発に焦点が移り、プラットフォーム全体のプロジェクトコストが増加します。そのため、IoVの分野では、MQTTプロトコルが優れている選択肢になっています。


## MQTTメッセージング製品やサービスの選び方?

システムアーキテクチャの設計と製品タイプの選択は、プラットフォーム設計において厳格なプロセスです。アプリケーションシナリオに合わせて、まず製品の機能がビジネス要件を満たし、性能とスケーラビリティが短期的なプラットフォームの設計容量と将来の成長をサポートできるかどうかを評価する必要があります。製品の使用コストも重要な基準です。製品自体のコスト、IaaSインフラストラクチャ、開発統合、およびメンテナンス作業は、顧客の総所有コストに影響を与えます。また、製品のグローバル化能力と組み合わせて評価することも重要です。海外ビジネスを持つプロジェクトでは、製品がグローバル展開をサポートし、異なる地域のコンプライアンスを満たすことが重要です。また、クラウドコンピューティングベンダーロックインを避けることも重要です。

モデルの選択プロセスでは、IoVの顧客はしばしばEMQとクラウドコンピューティングプロバイダーのIoTメッセージングSaaSサービスを比較します。対照的に、EMQXの利点は、プライベートデプロイメントと標準化能力であり、ベンダーロックインなしで任意のクラウドプラットフォームにプライベートデプロイメントをサポートすることができます。そして、一般的にIoVの顧客にとって価値のある標準のMQTTプロトコルをサポートしています。

クラウドコンピューティングサプライヤーロックインを避けることで、企業ユーザーは競争優位性を獲得し、企業とクラウドコンピューティングサプライヤーのパートナーシップの終了による影響を減らすことができます。また、マルチクラウドサポートは、異なるクラウドコンピューティングプロバイダーの技術的および商業的な利点を最大限に活用することができます。

また、EMQXの使用コストが低いという利点を享受する顧客も多数います。基本的な理由は、異なる課金方法により、ビジネススケールが大きくなるほど、クラウドコンピューティングプロバイダーのアクセスサービスコストが高くなるためです。

IoVプラットフォームビジネスは、EMQXのローカルインストール、管理、およびメンテナンス、および他のクラウドプロバイダーの選択肢のいずれかを選択する必要はありません。EMQX Cloudの導入により、EMQの完全に管理されたMQTTメッセージングサービスを利用することができます。これにより、明確で管理可能なコスト予算、クロスクラウドおよびクロスプラットフォームのプライベートデプロイメントと、IoVプラットフォームの構築を心配することなく実行できます。

プライベートデプロイメントのニーズがある顧客にとって、EMQXには独自の利点があります。EMQXはグローバルな商用サポートを提供しています。高い製品性能は、大量の接続性とスループットをもたらし、ルールエンジンとデータブリッジングは迅速な統合を提供できます。IoVの分野では、高信頼性とスケーラビリティのあるアーキテクチャ能力と、クラウドエッジコラボレーションのV2X情報相互作用能力により、プライベートデプロイメントをサポートする類似製品の中でEMQXが際立っています。

2018年、上海大众汽車は、新しいIoVシステムの設計と開発を行う際に、新しいIoVシステムの大規模な並行性、低遅延、高スループットの要件、および新しいIoVシステムアーキテクチャの主流を考慮し、MQTTプロトコルを採用して新しいIoVプラットフォームを構築しました。

このプロジェクトでは、MQTTの特性とEMQXの強力なルールエンジンデータ統合および一般バス能力が、複雑なネットワークでのメッセージのリアルタイム信頼性の要件を満たし、プロジェクト時間の制約を解決し、迅速な開発を実現しました。


## 最も一般的に使用されている技術的な解決策は何ですか？

メッセージブローカーとして、EMQXは豊富かつ柔軟な統合機能を提供し、各機能はユーザーが選択するための異なる技術的な解決策を提供しています。業界や技術選択の経験を積み重ねて、一般的な技術的な解決策は以下のようになります。

### セキュリティ保証

輸送リンク層では、TLS暗号化された転送を有効にすることを推奨しますが、ほとんどのクラウドコンピューティングプロバイダの負荷分散製品はTLS終了をサポートしていません。本番展開中には、HAProxyなどの追加コンポーネントを展開してTLS証明書を終了する必要があります。

TBoxアクセスにアクセスする最も一般的な方法は、証明書認証を使用することです。 EMQXは拡張可能な認証チェーンを提供し、サードパーティの認証プラットフォーム拡張（PKIシステムなど）、ユーザー名またはパスワードに基づく外部データソース、内部データベース認証をサポートしています。

さらに、ほとんどのユーザーはEMQX認証機能を有効にしており、異なるTBox端末に対して対応するパブリッシュおよびサブスクライブ権限を割り当てて、データセキュリティを効果的に保護しています。

![EMQX Security assurance](https://assets.emqx.com/images/4ff574a38707a1a8160882dca8cd16e7.png)


### データ統合

顧客は、EMQXを使用してIoVの大量のデータをビジネスシステムに接続する能力に重点を置いています。 EMQXには組み込みのルールエンジンとデータブリッジング機能があり、MQTTデータをKafka、さまざまなSQL / NoSQL /時系列データベースにストリーミングできます。実際のプロジェクトでは、ほとんどの顧客がバックエンドストリーム処理コンポーネントとしてKafkaを使用しています。

Kafkaはデータのストレージと読み取りに焦点を当てていますが、EMQXはクライアントとサーバー間の通信に焦点を当てています。 EMQXは、大量のIoTデバイスからメッセージを迅速に受信して処理するために使用されます。 Kafkaはこれらのデータを収集して保存し、バックエンドプログラムに送信して分析や処理を行うことができます。このアーキテクチャは現在最も広く使用されているデータ統合スキームです。

![EMQX Data integration](https://assets.emqx.com/images/382114e90c6a728659ac9316b73ddd60.png)

## 結論

現在、自動車電子の急速な発展は、IoVの産業の技術的なアップグレードを促進しています。インテリジェントトランスポートと車両産業の将来の市場見通しはかなりのものであり、より多くの消費者や車両メーカーがその恩恵を受けることが予想されます。MQTTプロトコルの完全なサポートとEMQXの強力な製品機能は、開発者が堅牢で柔軟なIoVプラットフォームを迅速に構築するのに役立ちます。 EMQはまた、メッセージ伝送とエッジコンピューティングに関連する技術の開発と実装に合わせて、業界の発展トレンドに追いつき、自動運転、車両協調、IoVユーザーに対してより速く、より良く、よりスマートなメッセージングインフラストラクチャを提供します。
