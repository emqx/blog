コミュニティ内のオープンソースおよび商用ソフトウェアをベースに、産業データの収集、集約、クリーニング、保存・分析、可視化・表示などの機能を統合した産業用IoTプラットフォームを構築する方法を紹介します。このソリューションに基づいて、読者は実際のビジネスニーズに合った産業用インターネットプラットフォームを構築し、産業インテリジェンス変革の実現を加速させるために、自分のニーズに応じてこのソリューション設計を調整することができます。



## インダストリアル・インターネットへの挑戦


産業分野では複数のプロトコルが共存しており、異種デバイスを接続し、その後のエッジコンピューティングやクラウドコンピューティングのためにデータを収束させる方法という問題を避けて通ることはできない。現在、2つの一般的なソリューションが利用可能です：

- エッジエンドでは、デバイスを直接接続し制御する従来のアプリケーションを採用します。このアプローチは、一般的に特定のデバイスやモデル向けで、カスタマイズ性は高いのですが、移植性、再利用性、拡張性、柔軟性に欠け、今日のビッグデータやAIのバックエンドとのインターフェースができず、データを深く分析してより大きな価値を生み出すことができません。
- クラウドアーキテクチャソフトウェアをエッジエンドに展開することで実装します。クラウドはIT業界が支配しており、情報レベルは非常に高い。しかし、エッジにあるハードウェア機器は、コストの関係から一般的に演算能力が限られており、クラウドアーキテクチャのソフトウェアをエッジ機器に直接移行することは現実的ではありません。エッジで上記の機能を実現するソフトウェアは、エッジでの実際の運用に合わせて最適化する必要がある。

、エッジにおけるOTとITの異なるニーズを統合するため、EMQは、産業インターネットのエッジが直面する問題や課題に現場の企業が対処できるよう、[産業インターネットクラウドエッジコラボレーション用ソリューション](https://github.com/emqx/edge-stack/)を正式に発表しました。このソリューションは、エッジでの展開に適しており、様々な産業プロトコルの解析、マルチソースデータアクセス、データ分析機能を備え、産業インターネットアーキテクチャ下のエッジ層の機能をクラウドエッジコラボレーション方式で迅速に実装することができます。


## ソリューション1：軽量エッジコンピューティング産業用インターネットプラットフォーム

このソリューションは、エッジで産業用プロトコルの解析、データ集約、ストリーミング解析を実施し、ストリーミング解析で得られたデータをエッジに配置された軽量の時系列データベースに保存することができます。エッジエンドで動作するアプリケーションは、時系列データベースからデータを取得し、それを処理してユーザーに提示することができます。エッジエンドで動作するEdge Managerは、ソフトウェアの設定と管理を容易にする管理コンソールを提供します。

![iiot_sol_1.jpg](https://assets.emqx.com/images/9ef14959f493f1988071226e28003dbc.jpg)

### 適用シナリオ

リアルタイム性の要求が高く、ゲートウェイやIPCのエッジで自律的な独立したアプリケーションとして実行でき、クラウドとの相互作用はない。このソリューションでは、すべての計算とストレージがエッジで実装されるため、ハードウェアに一定の要件があります。ユーザーは、実際の状況に応じて、ソフトウェアとアプリケーションを複数のハードウェアデバイスに別々に展開することができます。

### ソフトウェア一覧

本ソリューションでは、以下のリストにあるこれらのソフトウェア製品を使用します。
| No.  | Name                                                       | Provider     | Open source        |
| :--- | :--------------------------------------------------------- | :----------- | :----------------- |
| 1    | [EMQX Neuron](https://www.emqx.com/en/products/neuron)        | EMQ          | No - `1`           |
| 2    | [EMQX Edge](https://www.emqx.com/en/products/emqx)            | EMQ          | Yes, Apache 2.0    |
| 3    | [EMQX Kuiper](https://github.com/lf-edge/ekuiper)        | EMQ          | Yes, Apache 2.0    |
| 4    | [Edge manager](https://hub.docker.com/r/emqx/edge-manager) | EMQ          | No - `2`           |
| 5    | TDengine                                                   | Taosdata     | Yes, GNU AGPL v3.0 |
| 6    | Grafana                                                    | Grafana Labs | Yes, Apache 2.0    |

`1:` 将来的には、Neuronの基本機能をオープンソース化する予定です。現在、ユーザーは試用版をダウンロードし、無料で使用することができます。内蔵の試用版ではデータ収集ポイントが足りない場合は、EMQのウェブサイトからオンラインで申し込むことができます。

`2:` ユーザーは、管理ノード数の制限を除き、無料版の全機能を無料で使用することができます。より多くのノード管理機能を試したい場合は、EMQのウェブサイトからオンラインで申し込むことができます。

**製品の基本的な機能を説明します。**

1. Neuron：産業用IoTデータ収集
   - [Modbus](https://www.emqx.com/en/blog/building-modbus-based-iiot-app-with-neuron)，OPCUA，IEC61850，IEC104，BACnet などのプロトコルやデバイスをサポートします。
   - 管理コンソールです。ブラウザ上で産業機器全体の視覚的な設定やデータへのアクセスを可能にする。
   - ユーザーが指定した設定に基づき、指定されたMQTTメッセージサーバーにデータを送信するノースバウンド標準のMQTTデータ配信です。
   - Kuiperが提供するルールエンジン機能と連携して、ルールベースのデバイス制御を行うためのサウスバウンド制御インターフェースです。
   - デバイスの生データを保存し、閲覧するためのローカルデータストレージ。
2. Edge: 軽量MQTTメッセージブローカー
   - 産業機器メッセージのアグリゲーションを実施する。
   - ストリーミング処理ソフトを接続し、産業用データを処理する。
   - ルールエンジンの制御メッセージを受け取り、オフラインメッセージキャッシングを実装する。
   - クラウドメッセージングサーバーと連動し、オフラインでのメッセージキャッシングを可能にする。
3. Kuiper（カイパー）：SQLベースのIoTストリーミング処理フレームワーク
   - エッジ内でデータを継続的に消費、フィルタリング、変換、ルーティングする機能。
   - これをもとにフロー解析、ルールエンジン、メッセージプッシュを実装する。
   - 異なるデータソースへの対応、ERP、MES、WMS、エッジでの産業データの相互接続、リアルタイムでの分析・処理などを可能にする拡張が可能です。
4. エッジマネージャー：Neuron、Edge、Kuiperと統合されたWeb管理コンソール
   - ウェブ上で簡単に、統一されたビジュアル管理ができる。
   - 発行対象、データ送信対象のNeuronの設定も含めて実装した。
   - エッジの状態管理。
   - Kuiperストリーム、ルール、プラグインなどの管理。
5. TDengine：オープンソースの時系列データベース、収集したデータの加工を実装
   - 生データ、またはストリーミングされたデータをデータベースに保存すること。
   - アプリケーションは、SQLを通じて処理するためのデータにアクセスし、分析することができます。
6. Grafanaを使用しています：お客様のアプリケーションをシミュレートし、TDengineに保存されているデータを提示します。



**対応するハードウェアおよびソフトウェア環境**

- Raspberry Pie、Gateway、IPC 
- x86 & ARM - 64 bit、32 bit
- 一般的なLinuxシステムをサポート
- 物理マシン、Docker＆KubeEdge対応など。

| No.  | Name                                                       | x86*32 | x86*64 | ARM 7 | ARM 64 | PPC64 | Mac  | Docker |
| :--- | :--------------------------------------------------------- | :----- | :----- | :---- | :----- | :---- | :--- | :----- |
| 1    | [EMQX Neuron](https://www.emqx.com/en/products/neuron)        |        | ☑      | ☑     | ☑      | ☑     |      | ☑      |
| 2    | [EMQX Edge](https://www.emqx.com/en/products/emqx)            | ☑      | ☑      | ☑     | ☑      | ☑     | ☑    | ☑      |
| 3    | [EMQX Kuiper](https://github.com/lf-edge/ekuiper)        | ☑      | ☑      | ☑     | ☑      | ☑     | ☑    | ☑      |
| 4    | [Edge manager](https://hub.docker.com/r/emqx/edge-manager) | ☑      | ☑      | ☑     | ☑      | ☑     | ☑    | ☑      |
| 5    | TDengine                                                   | ☑      | ☑      |       | ☑      |       |      | ☑      |

### トライアル開始

デモシナリオでは、ユーザーが簡単に試せるように、DockerとDocker compose技術を利用して素早く展開できるようになっており、ユーザーは[チュートリアル](https://github.com/emqx/edge-stack/blob/master/developer-scripts/README.md)に従って、仮想ホスト、IPC、コンピューティング搭載ゲートウェイ上でソリューションを体験することができます。実際の業務システムの導入プロセスでは、ユーザーは必要に応じて本番環境にバイナリインストールパッケージで直接導入することができ、より効率的に実行することができます。

このサンプルシナリオでは、Modbus TCPプロトコルでデータを送り出し、システムに入る温度と湿度のデータをシミュレーションして、データの収集、集約、クリーニング、保存分析、可視化機能を実現します。以下は、Grafanaで提示される温度と湿度の可視化レポートです。

注意：TDengineが公開しているコンテナイメージは、デフォルトでx86*64環境用となっているため、ARMアーキテクチャに変更したい場合は、 `docker-compose.yml` を手動で変更して正しいバージョンを指すようにする必要があります。

## ソリューション2：クラウドエッジコラボレーション産業用インターネットプラットフォーム

このアプローチは、KubeEdge/IEFが提供するものと同様のエッジ上のコンテナベースのアプリケーションのための基礎的な配布およびオーケストレーション機能を備えた、クラウドエッジコラボレーションの概念を導入している点で上記とは異なります。Neuron、Edge、Kuiperなどのインスタンスを一元管理することで、エッジでのデータ収集・集計・分析ロジックをクラウド上でオンライン管理・更新することができます。また、クラウド上では、EMQX Enterpriseの分散型高可用性クラスタリング機能を導入することで、異なるエッジエンドポイントに分散したデバイスからのデータアクセスや分析が可能になります。

![iiot_sol_2.png](https://assets.emqx.com/images/b2159860f854daaface005fbf339dcd7.png)

### 適用シナリオ

本ソリューションは、複数の管理ノードがあり、異なる場所にあるエッジノードをクラウド上で集中的かつ統一的に制御・管理する必要があるビジネスシーンで利用されています。本ソリューションでは、ユーザーが物理的なエッジノードの所在地に出向いて管理する必要がないため、管理効率を大幅に向上させることができます。

- 多拠点・多ノード分散サポート：複数のエッジノードがあり、それらは工場内の異なる作業場、あるいは異なる都市の工業団地である可能性もあります。
- 大規模なデバイスへのアクセス：産業データとクラウド上の他のビジネスシステム（ERP、CRMなど）のデータを分析し、より価値のある分析結果を得る必要があります。
- クラウドエッジコラボレーション
  - エッジノードの管理・制御：クラウドエンドはエッジの物理ノードを制御・管理し、クラウドエンドからゲートウェイやIPCへのネットワーク接続をNAT後に開放し、クラウドからエッジへの制御を実現することができます。
  - アプリケーションとミドルウェアの展開：お客様のアプリケーションとソフトウェアの配布と展開を実施します。
  - 運用・保守管理：ソフトウェアの動作状況の監視、自動復旧など、ログ管理を実現します。

### ソフトウェア一覧

本ソリューションでは、ソリューション1のエッジエンドで使用した製品を除き、以下の製品を使用します。

| No.  | Name             | Provider | Open source |
| :--- | :--------------- | :------- | :---------- |
| 1    | EMQX Enterprise | EMQ      | No - `1`    |
| 2    | IEF              | Huawei   | No - `2`    |

`1`: EMQX EnterpriseエンタープライズIoT MQTTメッセージングプラットフォームは、数百万台のIoTデバイスへのワンストップアクセス、MQTT & CoAPマルチプロトコル処理、低遅延のリアルタイムメッセージ通信をサポートしています。SQLベースのルールエンジンを内蔵し、バックエンドサービスへのメッセージの柔軟な処理/転送、様々なデータベースへのメッセージデータの保存、またはKafka、RabbitMQやその他のエンタープライズミドルウェアへのブリッジをサポートします。

`2`: [IEF intelligent edge platforem (Intelligent EdgeFabric)](https://www.huaweicloud.com/product/ief.html) は、ファーウェイのオープンソースクラウドエッジコラボレーションプラットフォームであるKubeEdgeの商用化版で、エッジコンピューティングリソースのリモートコントロール、データ処理、分析・意思決定、インテリジェンスに対する顧客の要求を満たし、ユーザーにエッジとクラウド連携の完全統合サービスを提供しています。

### トライアル開始

- IEFプラットフォームは、ユーザーが直接アクセスして試すことができるファーウェイのパブリッククラウドサービスです。
- KuiperはIEFでライブ配信されており、IEFプラットフォームを通じて直接導入、インストール、メンテナンスが可能です（読者はビデオ「IEFでKuiperを使う方法」を参照できます）。IoTエッジストリーミングサービスを効率的に処理するためのクラウドエッジ連携 - Huawei IEF & EMQX Kuiper lightweight edge data solution」で、IEFでKuiperを使用する方法をご覧いただけます）。NeuronとEdgeは現在IEFでは利用できませんが、Docker Hubを介してエッジノードに直接インストールし、クラウド上のEdge Managerからユーザーが管理・制御することが可能です。
- EMQX Enterpriseは現在Huawei Cloudで稼働しており、ユーザーはEMQが提供するオンラインMQTTクラウドサービスも利用することができます。
- クラウドエンドデータの永続化またはブリッジング方式は、ユーザーのニーズに応じて選択することが可能です。関連情報は、EMQのホームページでご覧いただけます。



## 概要

本ソリューションが構築した産業用インターネットインフラ能力プラットフォームに基づき、ユーザーは効率的かつ低コストで産業用インターネットデバイスの接続、取得、分析を実施することができます。軽量なピュアエッジソリューションであっても、より複雑な展開環境を持つクラウドエッジコラボレーションソリューションであっても、本ソリューションによって実現することが可能です。
